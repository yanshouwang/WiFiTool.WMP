"use strict";
var wifis = [];
var wifi = {
    BSSID: "",
    SSID: "",
    secure: false,
    signalStrength: 0
};
var auto = "自动";
var manual = "手动";
Page({
    data: {
        device: {},
        type: "wifi",
        wifis: wifis,
        wifi: wifi,
        password: "",
        modes: [
            auto,
            manual
        ],
        ip: {
            mode: auto,
            address: "",
            mask: "",
            gateway: "",
        },
        dns: {
            mode: auto,
            values: []
        }
    },
    onLoad: function () {
        var _this = this;
        wx.onGetWifiList(function (res) { return _this.onGetWiFiList(res); });
        this.startWiFi();
    },
    onReady: function () {
    },
    onShow: function () {
    },
    onHide: function () {
    },
    onUnload: function () {
        this.stopWiFi();
    },
    onPullDownRefresh: function () {
    },
    onReachBottom: function () {
    },
    onShareAppMessage: function (opts) {
        console.log(opts.target);
        return {};
    },
    onGetWiFiList: function (res) {
        var wifis = res.wifiList;
        var wifi = this.data.wifi;
        if (wifi.SSID !== "") {
            wifis.unshift(wifi);
        }
        wifis = this.distinct(res.wifiList).sort(function (w1, w2) { return w1.SSID.localeCompare(w2.SSID); });
        console.log(wifis);
        var data = { wifis: wifis };
        this.setData(data);
    },
    onTapSSID: function () {
        var _this = this;
        var option1 = {
            success: function (res) {
                console.log("\u83B7\u53D6\u7CFB\u7EDF\u4FE1\u606F\u6210\u529F\uFF1A" + JSON.stringify(res));
                if (res.platform === "ios") {
                    var option2 = {
                        title: "提示",
                        content: "由于系统限制，iOS 用户请手动进入系统 WiFi 页面，当列表中出现目标 WiFi 时再返回小程序。",
                        showCancel: false,
                        success: function (res) {
                            console.log("提示框弹出成功");
                            if (res.confirm) {
                                _this.navigateToWiFi();
                            }
                        },
                        fail: function (res) { return console.log("\u63D0\u793A\u7A97\u5F39\u51FA\u5931\u8D25\uFF1A" + res.errMsg); }
                    };
                    wx.showModal(option2);
                }
                else {
                    _this.navigateToWiFi();
                }
            },
            fail: function (res) { return console.log("\u83B7\u53D6\u7CFB\u7EDF\u4FE1\u606F\u5931\u8D25\uFF1A" + res.errMsg); }
        };
        wx.getSystemInfo(option1);
    },
    onIPModeChange: function (e) {
        var number = e.detail.value;
        var mode = this.data.modes[number];
        var data = {};
        data["ip.mode"] = mode;
        this.setData(data);
    },
    onDNSModeChange: function (e) {
        var number = e.detail.value;
        var mode = this.data.modes[number];
        var data = {};
        data["dns.mode"] = mode;
        this.setData(data);
    },
    navigateToWiFi: function () {
        var wifi = this.data.wifi;
        var option = {
            url: "../wifi/wifi",
            success: function (res) {
                console.log("跳转 WiFi 页面成功");
                res.eventChannel.emit("wifi", wifi);
            },
            fail: function (res) { return console.log("\u8DF3\u8F6C WiFi \u9875\u9762\u5931\u8D25\uFF1A" + res.errMsg); }
        };
        wx.navigateTo(option);
    },
    onWiFiChange: function (e) {
        var number = e.detail.value;
        var ssid = this.data.wifis[number].SSID;
        var data = { "ssid": ssid };
        this.setData(data);
    },
    distinct: function (arr) {
        var res = [];
        arr.forEach(function (w1) {
            var some = res.some(function (w2) { return w1.SSID === w2.SSID; });
            if (some) {
                return;
            }
            res.push(w1);
        });
        return res;
    },
    onSubmit: function () {
    },
    startWiFi: function () {
        var _this = this;
        var option = {
            success: function () {
                console.log("打开 WiFi 模块成功");
                _this.getConnectedWiFi();
            },
            fail: function (res) { return console.log("\u6253\u5F00 WiFi \u6A21\u5757\u5931\u8D25\uFF1A" + res.errCode + " - " + res.errMsg); }
        };
        wx.startWifi(option);
    },
    stopWiFi: function () {
        var option = {
            success: function () { return console.log("关闭 WiFi 模块成功"); },
            fail: function (res) { return console.log("\u5173\u95ED WiFi \u6A21\u5757\u5931\u8D25\uFF1A" + res.errCode + " - " + res.errMsg); }
        };
        wx.stopWifi(option);
    },
    getConnectedWiFi: function () {
        var _this = this;
        var option = {
            success: function (res) {
                var wifi = res.wifi;
                console.log("\u83B7\u53D6\u5DF2\u8FDE\u63A5 WiFi \u6210\u529F: " + wifi);
                var data = { "wifis": [wifi], "ssid": wifi.SSID };
                _this.setData(data);
            },
            fail: function (res) { return console.log("\u83B7\u53D6\u5DF2\u8FDE\u63A5 WiFi \u5931\u8D25: " + res.errCode + " - " + res.errMsg); }
        };
        wx.getConnectedWifi(option);
    },
    getWiFiList: function () {
        var _this = this;
        var option1 = {
            success: function (res) {
                console.log("\u83B7\u53D6\u8BBE\u7F6E\u6210\u529F\uFF1A" + res.authSetting);
                if (res.authSetting["scope.userLocation"]) {
                    var option2 = {
                        success: function () { return console.log("\u83B7\u53D6 WiFi \u5217\u8868\u6210\u529F"); },
                        fail: function (res) { return console.log("\u83B7\u53D6 WiFi \u5217\u8868\u5931\u8D25\uFF1A" + res.errCode + " - " + res.errMsg); }
                    };
                    wx.getWifiList(option2);
                }
                else {
                    _this.authorize();
                }
            },
            fail: function (res) { return console.log("\u83B7\u53D6\u8BBE\u7F6E\u5931\u8D25\uFF1A" + res.errMsg); }
        };
        wx.getSetting(option1);
    },
    authorize: function () {
        var _this = this;
        var option = {
            scope: "scope.userLocation",
            success: function () {
                console.log("申请权限成功");
                _this.getWiFiList();
            },
            fail: function (res) { return console.log("\u7533\u8BF7\u6743\u9650\u5931\u8D25\uFF1A" + res.errMsg); }
        };
        wx.authorize(option);
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWRhcHRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImFkYXB0ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLElBQU0sS0FBSyxHQUFpQyxFQUFFLENBQUM7QUFDL0MsSUFBTSxJQUFJLEdBQStCO0lBQ3ZDLEtBQUssRUFBRSxFQUFFO0lBQ1QsSUFBSSxFQUFFLEVBQUU7SUFDUixNQUFNLEVBQUUsS0FBSztJQUNiLGNBQWMsRUFBRSxDQUFDO0NBQ2xCLENBQUM7QUFFRixJQUFNLElBQUksR0FBRyxJQUFJLENBQUM7QUFDbEIsSUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDO0FBRXBCLElBQUksQ0FBQztJQUtILElBQUksRUFBRTtRQUNKLE1BQU0sRUFBRSxFQUFFO1FBQ1YsSUFBSSxFQUFFLE1BQU07UUFDWixLQUFLLEVBQUUsS0FBSztRQUNaLElBQUksRUFBRSxJQUFJO1FBQ1YsUUFBUSxFQUFFLEVBQUU7UUFDWixLQUFLLEVBQUU7WUFDTCxJQUFJO1lBQ0osTUFBTTtTQUNQO1FBQ0QsRUFBRSxFQUFFO1lBQ0YsSUFBSSxFQUFFLElBQUk7WUFDVixPQUFPLEVBQUUsRUFBRTtZQUNYLElBQUksRUFBRSxFQUFFO1lBQ1IsT0FBTyxFQUFFLEVBQUU7U0FDWjtRQUNELEdBQUcsRUFBRTtZQUNILElBQUksRUFBRSxJQUFJO1lBQ1YsTUFBTSxFQUFFLEVBQUU7U0FDWDtLQUNGO0lBS0QsTUFBTTtRQUFOLGlCQUtDO1FBSkMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxVQUFBLEdBQUcsSUFBSSxPQUFBLEtBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLEVBQXZCLENBQXVCLENBQUMsQ0FBQztRQUdqRCxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDbkIsQ0FBQztJQUtELE9BQU87SUFFUCxDQUFDO0lBS0QsTUFBTTtJQUVOLENBQUM7SUFLRCxNQUFNO0lBRU4sQ0FBQztJQUtELFFBQVE7UUFFTixJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7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Q0FBQyxPQUFPLENBQUMsQ0FBQztpQkFDekI7cUJBQU07b0JBQ0wsS0FBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO2lCQUNsQjtZQUNILENBQUM7WUFDRCxJQUFJLEVBQUUsVUFBQSxHQUFHLElBQUksT0FBQSxPQUFPLENBQUMsR0FBRyxDQUFDLCtDQUFVLEdBQUcsQ0FBQyxNQUFRLENBQUMsRUFBbkMsQ0FBbUM7U0FDakQsQ0FBQztRQUNGLEVBQUUsQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDekIsQ0FBQztJQUVELFNBQVM7UUFBVCxpQkFXQztRQVZDLElBQU0sTUFBTSxHQUFzQztZQUNoRCxLQUFLLEVBQUUsb0JBQW9CO1lBQzNCLE9BQU8sRUFBRTtnQkFDUCxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUV0QixLQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDckIsQ0FBQztZQUNELElBQUksRUFBRSxVQUFBLEdBQUcsSUFBSSxPQUFBLE9BQU8sQ0FBQyxHQUFHLENBQUMsK0NBQVUsR0FBRyxDQUFDLE1BQVEsQ0FBQyxFQUFuQyxDQUFtQztTQUNqRCxDQUFDO1FBQ0YsRUFBRSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUN2QixDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgd2lmaXM6IFdlY2hhdE1pbmlwcm9ncmFtLldpZmlJbmZvW10gPSBbXTtcclxuY29uc3Qgd2lmaTogV2VjaGF0TWluaXByb2dyYW0uV2lmaUluZm8gPSB7XHJcbiAgQlNTSUQ6IFwiXCIsXHJcbiAgU1NJRDogXCJcIixcclxuICBzZWN1cmU6IGZhbHNlLFxyXG4gIHNpZ25hbFN0cmVuZ3RoOiAwXHJcbn07XHJcblxyXG5jb25zdCBhdXRvID0gXCLoh6rliqhcIjtcclxuY29uc3QgbWFudWFsID0gXCLmiYvliqhcIjtcclxuXHJcblBhZ2Uoe1xyXG5cclxuICAvKipcclxuICAgKiDpobXpnaLnmoTliJ3lp4vmlbDmja5cclxuICAgKi9cclxuICBkYXRhOiB7XHJcbiAgICBkZXZpY2U6IHt9LFxyXG4gICAgdHlwZTogXCJ3aWZpXCIsXHJcbiAgICB3aWZpczogd2lmaXMsXHJcbiAgICB3aWZpOiB3aWZpLFxyXG4gICAgcGFzc3dvcmQ6IFwiXCIsXHJcbiAgICBtb2RlczogW1xyXG4gICAgICBhdXRvLFxyXG4gICAgICBtYW51YWxcclxuICAgIF0sXHJcbiAgICBpcDoge1xyXG4gICAgICBtb2RlOiBhdXRvLFxyXG4gICAgICBhZGRyZXNzOiBcIlwiLFxyXG4gICAgICBtYXNrOiBcIlwiLFxyXG4gICAgICBnYXRld2F5OiBcIlwiLFxyXG4gICAgfSxcclxuICAgIGRuczoge1xyXG4gICAgICBtb2RlOiBhdXRvLFxyXG4gICAgICB2YWx1ZXM6IFtdXHJcbiAgICB9XHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLliqDovb1cclxuICAgKi9cclxuICBvbkxvYWQoKSB7XHJcbiAgICB3eC5vbkdldFdpZmlMaXN0KHJlcyA9PiB0aGlzLm9uR2V0V2lGaUxpc3QocmVzKSk7XHJcblxyXG4gICAgLy8g5omT5byAIFdpRmkg5qih5Z2XXHJcbiAgICB0aGlzLnN0YXJ0V2lGaSgpO1xyXG4gIH0sXHJcblxyXG4gIC8qKlxyXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i5Yid5qyh5riy5p+T5a6M5oiQXHJcbiAgICovXHJcbiAgb25SZWFkeSgpIHtcclxuXHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLmmL7npLpcclxuICAgKi9cclxuICBvblNob3coKSB7XHJcblxyXG4gIH0sXHJcblxyXG4gIC8qKlxyXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i6ZqQ6JePXHJcbiAgICovXHJcbiAgb25IaWRlKCkge1xyXG5cclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWNuOi9vVxyXG4gICAqL1xyXG4gIG9uVW5sb2FkKCkge1xyXG4gICAgLy8g5YWz6ZetIFdpRmkg5qih5Z2XXHJcbiAgICB0aGlzLnN0b3BXaUZpKCk7XHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICog6aG16Z2i55u45YWz5LqL5Lu25aSE55CG5Ye95pWwLS3nm5HlkKznlKjmiLfkuIvmi4nliqjkvZxcclxuICAgKi9cclxuICBvblB1bGxEb3duUmVmcmVzaCgpIHtcclxuXHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICog6aG16Z2i5LiK5ouJ6Kem5bqV5LqL5Lu255qE5aSE55CG5Ye95pWwXHJcbiAgICovXHJcbiAgb25SZWFjaEJvdHRvbSgpIHtcclxuXHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICog55So5oi354K55Ye75Y+z5LiK6KeS5YiG5LqrXHJcbiAgICovXHJcbiAgb25TaGFyZUFwcE1lc3NhZ2Uob3B0cyk6IFdlY2hhdE1pbmlwcm9ncmFtLlBhZ2UuSUN1c3RvbVNoYXJlQ29udGVudCB7XHJcbiAgICBjb25zb2xlLmxvZyhvcHRzLnRhcmdldClcclxuICAgIHJldHVybiB7fVxyXG4gIH0sXHJcblxyXG4gIG9uR2V0V2lGaUxpc3QocmVzOiBXZWNoYXRNaW5pcHJvZ3JhbS5PbkdldFdpZmlMaXN0Q2FsbGJhY2tSZXN1bHQpIHtcclxuICAgIGxldCB3aWZpcyA9IHJlcy53aWZpTGlzdDtcclxuICAgIGNvbnN0IHdpZmkgPSB0aGlzLmRhdGEud2lmaTtcclxuICAgIGlmICh3aWZpLlNTSUQgIT09IFwiXCIpIHtcclxuICAgICAgd2lmaXMudW5zaGlmdCh3aWZpKTtcclxuICAgIH1cclxuICAgIHdpZmlzID0gdGhpcy5kaXN0aW5jdChyZXMud2lmaUxpc3QpLnNvcnQoKHcxLCB3MikgPT4gdzEuU1NJRC5sb2NhbGVDb21wYXJlKHcyLlNTSUQpKTtcclxuICAgIGNvbnNvbGUubG9nKHdpZmlzKTtcclxuXHJcbiAgICBjb25zdCBkYXRhID0geyB3aWZpczogd2lmaXMgfTtcclxuICAgIHRoaXMuc2V0RGF0YShkYXRhKTtcclxuICB9LFxyXG5cclxuICBvblRhcFNTSUQoKSB7XHJcbiAgICBjb25zdCBvcHRpb24xOiBXZWNoYXRNaW5pcHJvZ3JhbS5HZXRTeXN0ZW1JbmZvT3B0aW9uID0ge1xyXG4gICAgICBzdWNjZXNzOiByZXMgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGDojrflj5bns7vnu5/kv6Hmga/miJDlip/vvJoke0pTT04uc3RyaW5naWZ5KHJlcyl9YCk7XHJcblxyXG4gICAgICAgIC8vIGlPUyDpnIDopoHmj5DnpLrnlKjmiLfot7Povazns7vnu5/orr7nva7nlYzpnaJcclxuICAgICAgICBpZiAocmVzLnBsYXRmb3JtID09PSBcImlvc1wiKSB7XHJcbiAgICAgICAgICBjb25zdCBvcHRpb24yOiBXZWNoYXRNaW5pcHJvZ3JhbS5TaG93TW9kYWxPcHRpb24gPSB7XHJcbiAgICAgICAgICAgIHRpdGxlOiBcIuaPkOekulwiLFxyXG4gICAgICAgICAgICBjb250ZW50OiBcIueUseS6juezu+e7n+mZkOWItu+8jGlPUyDnlKjmiLfor7fmiYvliqjov5vlhaXns7vnu58gV2lGaSDpobXpnaLvvIzlvZPliJfooajkuK3lh7rnjrDnm67moIcgV2lGaSDml7blho3ov5Tlm57lsI/nqIvluo/jgIJcIixcclxuICAgICAgICAgICAgc2hvd0NhbmNlbDogZmFsc2UsXHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHJlcyA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coXCLmj5DnpLrmoYblvLnlh7rmiJDlip9cIik7XHJcblxyXG4gICAgICAgICAgICAgIGlmIChyZXMuY29uZmlybSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5uYXZpZ2F0ZVRvV2lGaSgpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZmFpbDogcmVzID0+IGNvbnNvbGUubG9nKGDmj5DnpLrnqpflvLnlh7rlpLHotKXvvJoke3Jlcy5lcnJNc2d9YClcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICB3eC5zaG93TW9kYWwob3B0aW9uMik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMubmF2aWdhdGVUb1dpRmkoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIGZhaWw6IHJlcyA9PiBjb25zb2xlLmxvZyhg6I635Y+W57O757uf5L+h5oGv5aSx6LSl77yaJHtyZXMuZXJyTXNnfWApXHJcbiAgICB9O1xyXG4gICAgd3guZ2V0U3lzdGVtSW5mbyhvcHRpb24xKTtcclxuICAgIC8vdGhpcy5nZXRXaUZpTGlzdCgpO1xyXG4gIH0sXHJcblxyXG4gIG9uSVBNb2RlQ2hhbmdlKGU6IFJlY29yZDxzdHJpbmcsIGFueT4pIHtcclxuICAgIGNvbnN0IG51bWJlciA9IGUuZGV0YWlsLnZhbHVlO1xyXG4gICAgY29uc3QgbW9kZSA9IHRoaXMuZGF0YS5tb2Rlc1tudW1iZXJdO1xyXG4gICAgY29uc3QgZGF0YTogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9O1xyXG4gICAgZGF0YVtcImlwLm1vZGVcIl0gPSBtb2RlO1xyXG4gICAgdGhpcy5zZXREYXRhKGRhdGEpO1xyXG4gIH0sXHJcblxyXG4gIG9uRE5TTW9kZUNoYW5nZShlOiBSZWNvcmQ8c3RyaW5nLCBhbnk+KSB7XHJcbiAgICBjb25zdCBudW1iZXIgPSBlLmRldGFpbC52YWx1ZTtcclxuICAgIGNvbnN0IG1vZGUgPSB0aGlzLmRhdGEubW9kZXNbbnVtYmVyXTtcclxuICAgIGNvbnN0IGRhdGE6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fTtcclxuICAgIGRhdGFbXCJkbnMubW9kZVwiXSA9IG1vZGU7XHJcbiAgICB0aGlzLnNldERhdGEoZGF0YSk7XHJcbiAgfSxcclxuXHJcbiAgbmF2aWdhdGVUb1dpRmkoKSB7XHJcbiAgICBjb25zdCB3aWZpID0gdGhpcy5kYXRhLndpZmk7XHJcbiAgICBjb25zdCBvcHRpb246IFdlY2hhdE1pbmlwcm9ncmFtLk5hdmlnYXRlVG9PcHRpb24gPSB7XHJcbiAgICAgIHVybDogXCIuLi93aWZpL3dpZmlcIixcclxuICAgICAgc3VjY2VzczogcmVzID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIui3s+i9rCBXaUZpIOmhtemdouaIkOWKn1wiKTtcclxuXHJcbiAgICAgICAgcmVzLmV2ZW50Q2hhbm5lbC5lbWl0KFwid2lmaVwiLCB3aWZpKTtcclxuICAgICAgfSxcclxuICAgICAgZmFpbDogcmVzID0+IGNvbnNvbGUubG9nKGDot7PovawgV2lGaSDpobXpnaLlpLHotKXvvJoke3Jlcy5lcnJNc2d9YClcclxuICAgIH07XHJcbiAgICB3eC5uYXZpZ2F0ZVRvKG9wdGlvbik7XHJcbiAgfSxcclxuXHJcbiAgb25XaUZpQ2hhbmdlKGU6IGFueSkge1xyXG4gICAgY29uc3QgbnVtYmVyID0gZS5kZXRhaWwudmFsdWU7XHJcbiAgICBjb25zdCBzc2lkID0gdGhpcy5kYXRhLndpZmlzW251bWJlcl0uU1NJRDtcclxuICAgIGNvbnN0IGRhdGEgPSB7IFwic3NpZFwiOiBzc2lkIH07XHJcbiAgICB0aGlzLnNldERhdGEoZGF0YSk7XHJcbiAgfSxcclxuXHJcbiAgZGlzdGluY3QoYXJyOiBXZWNoYXRNaW5pcHJvZ3JhbS5XaWZpSW5mb1tdKTogV2VjaGF0TWluaXByb2dyYW0uV2lmaUluZm9bXSB7XHJcbiAgICBjb25zdCByZXM6IFdlY2hhdE1pbmlwcm9ncmFtLldpZmlJbmZvW10gPSBbXTtcclxuICAgIGFyci5mb3JFYWNoKHcxID0+IHtcclxuICAgICAgY29uc3Qgc29tZSA9IHJlcy5zb21lKHcyID0+IHcxLlNTSUQgPT09IHcyLlNTSUQpO1xyXG4gICAgICBpZiAoc29tZSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICByZXMucHVzaCh3MSk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiByZXM7XHJcbiAgfSxcclxuXHJcbiAgb25TdWJtaXQoKSB7XHJcbiAgICAvLyBjb25zdCBtb2RlID0gXCJcIjtcclxuICAgIC8vIGNvbnN0IGFkZHJlc3MgPSB0aGlzLmRhdGEuYWRkcmVzcztcclxuICAgIC8vIGNvbnN0IG1hc2sgPSB0aGlzLmRhdGEubWFzaztcclxuICAgIC8vIGNvbnN0IGdhdGV3YXkgPSB0aGlzLmRhdGEuaXAuZ2F0ZXdheTtcclxuICAgIC8vIGNvbnN0IGRucyA9IHRoaXMuZGF0YS5kbnMudmFsdWVzO1xyXG4gICAgLy8gc3dpdGNoIChtb2RlKSB7XHJcbiAgICAvLyAgIGNhc2UgZXRoZXJuZXQ6IHtcclxuICAgIC8vICAgICB0aGlzLm1vZGlmeShcImV0aGVybmV0XCIsIGFkZHJlc3MsIG1hc2ssIGdhdGV3YXksIGRucyk7XHJcbiAgICAvLyAgICAgYnJlYWs7XHJcbiAgICAvLyAgIH1cclxuICAgIC8vICAgY2FzZSB3aWZpOiB7XHJcbiAgICAvLyAgICAgY29uc3Qgc3NpZCA9IHRoaXMuZGF0YS5zc2lkO1xyXG4gICAgLy8gICAgIGNvbnN0IHBhc3N3b3JkID0gdGhpcy5kYXRhLnBhc3N3b3JkO1xyXG4gICAgLy8gICAgIHRoaXMubW9kaWZ5KFwid2lmaVwiLCBhZGRyZXNzLCBtYXNrLCBnYXRld2F5LCBkbnMsIHNzaWQsIHBhc3N3b3JkKTtcclxuICAgIC8vICAgICBicmVhaztcclxuICAgIC8vICAgfVxyXG4gICAgLy8gICBkZWZhdWx0OiB7XHJcbiAgICAvLyAgICAgY29uc29sZS5sb2coYOi/nuaOpeaooeW8j+mUmeivr++8miR7bW9kZX1gKTtcclxuICAgIC8vICAgICBicmVhaztcclxuICAgIC8vICAgfVxyXG4gICAgLy8gfVxyXG4gIH0sXHJcblxyXG4gIHN0YXJ0V2lGaSgpIHtcclxuICAgIGNvbnN0IG9wdGlvbjogV2VjaGF0TWluaXByb2dyYW0uU3RhcnRXaWZpT3B0aW9uID0ge1xyXG4gICAgICBzdWNjZXNzOiAoKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCLmiZPlvIAgV2lGaSDmqKHlnZfmiJDlip9cIik7XHJcblxyXG4gICAgICAgIHRoaXMuZ2V0Q29ubmVjdGVkV2lGaSgpO1xyXG4gICAgICB9LFxyXG4gICAgICBmYWlsOiByZXMgPT4gY29uc29sZS5sb2coYOaJk+W8gCBXaUZpIOaooeWdl+Wksei0pe+8miR7cmVzLmVyckNvZGV9IC0gJHtyZXMuZXJyTXNnfWApXHJcbiAgICB9O1xyXG4gICAgd3guc3RhcnRXaWZpKG9wdGlvbik7XHJcbiAgfSxcclxuXHJcbiAgc3RvcFdpRmkoKSB7XHJcbiAgICBjb25zdCBvcHRpb246IFdlY2hhdE1pbmlwcm9ncmFtLlN0b3BXaWZpT3B0aW9uID0ge1xyXG4gICAgICBzdWNjZXNzOiAoKSA9PiBjb25zb2xlLmxvZyhcIuWFs+mXrSBXaUZpIOaooeWdl+aIkOWKn1wiKSxcclxuICAgICAgZmFpbDogcmVzID0+IGNvbnNvbGUubG9nKGDlhbPpl60gV2lGaSDmqKHlnZflpLHotKXvvJoke3Jlcy5lcnJDb2RlfSAtICR7cmVzLmVyck1zZ31gKVxyXG4gICAgfTtcclxuICAgIHd4LnN0b3BXaWZpKG9wdGlvbik7XHJcbiAgfSxcclxuXHJcbiAgZ2V0Q29ubmVjdGVkV2lGaSgpIHtcclxuICAgIGNvbnN0IG9wdGlvbjogV2VjaGF0TWluaXByb2dyYW0uR2V0Q29ubmVjdGVkV2lmaU9wdGlvbiA9IHtcclxuICAgICAgc3VjY2VzczogcmVzID0+IHtcclxuICAgICAgICBjb25zdCB3aWZpID0gcmVzLndpZmk7XHJcbiAgICAgICAgY29uc29sZS5sb2coYOiOt+WPluW3sui/nuaOpSBXaUZpIOaIkOWKnzogJHt3aWZpfWApO1xyXG5cclxuICAgICAgICBjb25zdCBkYXRhID0geyBcIndpZmlzXCI6IFt3aWZpXSwgXCJzc2lkXCI6IHdpZmkuU1NJRCB9O1xyXG4gICAgICAgIHRoaXMuc2V0RGF0YShkYXRhKTtcclxuICAgICAgfSxcclxuICAgICAgZmFpbDogcmVzID0+IGNvbnNvbGUubG9nKGDojrflj5blt7Lov57mjqUgV2lGaSDlpLHotKU6ICR7cmVzLmVyckNvZGV9IC0gJHtyZXMuZXJyTXNnfWApXHJcbiAgICB9O1xyXG4gICAgd3guZ2V0Q29ubmVjdGVkV2lmaShvcHRpb24pO1xyXG4gIH0sXHJcblxyXG4gIGdldFdpRmlMaXN0KCkge1xyXG4gICAgY29uc3Qgb3B0aW9uMTogV2VjaGF0TWluaXByb2dyYW0uR2V0U2V0dGluZ09wdGlvbiA9IHtcclxuICAgICAgc3VjY2VzczogcmVzID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhg6I635Y+W6K6+572u5oiQ5Yqf77yaJHtyZXMuYXV0aFNldHRpbmd9YCk7XHJcblxyXG4gICAgICAgIGlmIChyZXMuYXV0aFNldHRpbmdbXCJzY29wZS51c2VyTG9jYXRpb25cIl0pIHtcclxuICAgICAgICAgIGNvbnN0IG9wdGlvbjI6IFdlY2hhdE1pbmlwcm9ncmFtLkdldFdpZmlMaXN0T3B0aW9uID0ge1xyXG4gICAgICAgICAgICBzdWNjZXNzOiAoKSA9PiBjb25zb2xlLmxvZyhg6I635Y+WIFdpRmkg5YiX6KGo5oiQ5YqfYCksXHJcbiAgICAgICAgICAgIGZhaWw6IHJlcyA9PiBjb25zb2xlLmxvZyhg6I635Y+WIFdpRmkg5YiX6KGo5aSx6LSl77yaJHtyZXMuZXJyQ29kZX0gLSAke3Jlcy5lcnJNc2d9YClcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICB3eC5nZXRXaWZpTGlzdChvcHRpb24yKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5hdXRob3JpemUoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIGZhaWw6IHJlcyA9PiBjb25zb2xlLmxvZyhg6I635Y+W6K6+572u5aSx6LSl77yaJHtyZXMuZXJyTXNnfWApXHJcbiAgICB9O1xyXG4gICAgd3guZ2V0U2V0dGluZyhvcHRpb24xKTtcclxuICB9LFxyXG5cclxuICBhdXRob3JpemUoKSB7XHJcbiAgICBjb25zdCBvcHRpb246IFdlY2hhdE1pbmlwcm9ncmFtLkF1dGhvcml6ZU9wdGlvbiA9IHtcclxuICAgICAgc2NvcGU6IFwic2NvcGUudXNlckxvY2F0aW9uXCIsXHJcbiAgICAgIHN1Y2Nlc3M6ICgpID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIueUs+ivt+adg+mZkOaIkOWKn1wiKTtcclxuXHJcbiAgICAgICAgdGhpcy5nZXRXaUZpTGlzdCgpO1xyXG4gICAgICB9LFxyXG4gICAgICBmYWlsOiByZXMgPT4gY29uc29sZS5sb2coYOeUs+ivt+adg+mZkOWksei0pe+8miR7cmVzLmVyck1zZ31gKVxyXG4gICAgfTtcclxuICAgIHd4LmF1dGhvcml6ZShvcHRpb24pO1xyXG4gIH0sXHJcbn0pIl19