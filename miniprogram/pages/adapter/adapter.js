"use strict";
var wifis = [];
var wifi = {
    BSSID: "",
    SSID: "",
    secure: false,
    signalStrength: 0
};
var auto = "自动";
var manual = "手动";
Page({
    data: {
        device: {},
        type: "wifi",
        wifis: wifis,
        wifi: wifi,
        password: "",
        modes: [
            auto,
            manual
        ],
        ip: {
            mode: auto,
            address: "",
            mask: "",
            gateway: "",
        },
        dns: {
            mode: auto,
            values: []
        }
    },
    onLoad: function () {
        var _this = this;
        wx.onGetWifiList(function (res) { return _this.onGetWiFiList(res); });
        this.startWiFi();
    },
    onReady: function () {
    },
    onShow: function () {
    },
    onHide: function () {
    },
    onUnload: function () {
        this.stopWiFi();
    },
    onPullDownRefresh: function () {
    },
    onReachBottom: function () {
    },
    onShareAppMessage: function (opts) {
        console.log(opts.target);
        return {};
    },
    onGetWiFiList: function (res) {
        var wifis = res.wifiList;
        var wifi = this.data.wifi;
        if (wifi.SSID !== "") {
            wifis.unshift(wifi);
        }
        wifis = this.distinct(res.wifiList).sort(function (w1, w2) { return w1.SSID.localeCompare(w2.SSID); });
        console.log(wifis);
        var data = { wifis: wifis };
        this.setData(data);
    },
    onTapSSID: function () {
        var _this = this;
        var option1 = {
            success: function (res) {
                console.log("\u83B7\u53D6\u7CFB\u7EDF\u4FE1\u606F\u6210\u529F\uFF1A" + res);
                if (res.platform === "ios") {
                    var option2 = {
                        title: "提示",
                        content: "由于系统限制，iOS 用户请手动进入系统 WiFi 页面，当列表中出现目标 WiFi 时再返回小程序。",
                        showCancel: false,
                        success: function (res) {
                            console.log("提示框弹出成功");
                            if (res.confirm) {
                                _this.navigateToWiFi();
                            }
                        },
                        fail: function (res) { return console.log("\u63D0\u793A\u7A97\u5F39\u51FA\u5931\u8D25\uFF1A" + res.errMsg); }
                    };
                    wx.showModal(option2);
                }
                else {
                    _this.navigateToWiFi();
                }
            },
            fail: function (res) { return console.log("\u83B7\u53D6\u7CFB\u7EDF\u4FE1\u606F\u5931\u8D25\uFF1A" + res.errMsg); }
        };
        wx.getSystemInfo(option1);
    },
    onIPModeChange: function (e) {
        var number = e.detail.value;
        var mode = this.data.modes[number];
        var data = {};
        data["ip.mode"] = mode;
        this.setData(data);
    },
    onDNSModeChange: function () {
    },
    navigateToWiFi: function () {
        var wifi = this.data.wifi;
        var option = {
            url: "../wifi/wifi",
            success: function (res) {
                console.log("跳转 WiFi 页面成功");
                res.eventChannel.emit("wifi", wifi);
            },
            fail: function (res) { return console.log("\u8DF3\u8F6C WiFi \u9875\u9762\u5931\u8D25\uFF1A" + res.errMsg); }
        };
        wx.navigateTo(option);
    },
    onWiFiChange: function (e) {
        var number = e.detail.value;
        var ssid = this.data.wifis[number].SSID;
        var data = { "ssid": ssid };
        this.setData(data);
    },
    distinct: function (arr) {
        var res = [];
        arr.forEach(function (w1) {
            var some = res.some(function (w2) { return w1.SSID === w2.SSID; });
            if (some) {
                return;
            }
            res.push(w1);
        });
        return res;
    },
    onSubmit: function () {
    },
    startWiFi: function () {
        var _this = this;
        var option = {
            success: function () {
                console.log("打开 WiFi 模块成功");
                _this.getConnectedWiFi();
            },
            fail: function (res) { return console.log("\u6253\u5F00 WiFi \u6A21\u5757\u5931\u8D25\uFF1A" + res.errCode + " - " + res.errMsg); }
        };
        wx.startWifi(option);
    },
    stopWiFi: function () {
        var option = {
            success: function () { return console.log("关闭 WiFi 模块成功"); },
            fail: function (res) { return console.log("\u5173\u95ED WiFi \u6A21\u5757\u5931\u8D25\uFF1A" + res.errCode + " - " + res.errMsg); }
        };
        wx.stopWifi(option);
    },
    getConnectedWiFi: function () {
        var _this = this;
        var option = {
            success: function (res) {
                var wifi = res.wifi;
                console.log("\u83B7\u53D6\u5DF2\u8FDE\u63A5 WiFi \u6210\u529F: " + wifi);
                var data = { "wifis": [wifi], "ssid": wifi.SSID };
                _this.setData(data);
            },
            fail: function (res) { return console.log("\u83B7\u53D6\u5DF2\u8FDE\u63A5 WiFi \u5931\u8D25: " + res.errCode + " - " + res.errMsg); }
        };
        wx.getConnectedWifi(option);
    },
    getWiFiList: function () {
        var _this = this;
        var option1 = {
            success: function (res) {
                console.log("\u83B7\u53D6\u8BBE\u7F6E\u6210\u529F\uFF1A" + res.authSetting);
                if (res.authSetting["scope.userLocation"]) {
                    var option2 = {
                        success: function () { return console.log("\u83B7\u53D6 WiFi \u5217\u8868\u6210\u529F"); },
                        fail: function (res) { return console.log("\u83B7\u53D6 WiFi \u5217\u8868\u5931\u8D25\uFF1A" + res.errCode + " - " + res.errMsg); }
                    };
                    wx.getWifiList(option2);
                }
                else {
                    _this.authorize();
                }
            },
            fail: function (res) { return console.log("\u83B7\u53D6\u8BBE\u7F6E\u5931\u8D25\uFF1A" + res.errMsg); }
        };
        wx.getSetting(option1);
    },
    authorize: function () {
        var _this = this;
        var option = {
            scope: "scope.userLocation",
            success: function () {
                console.log("申请权限成功");
                _this.getWiFiList();
            },
            fail: function (res) { return console.log("\u7533\u8BF7\u6743\u9650\u5931\u8D25\uFF1A" + res.errMsg); }
        };
        wx.authorize(option);
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWRhcHRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImFkYXB0ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLElBQU0sS0FBSyxHQUFpQyxFQUFFLENBQUM7QUFDL0MsSUFBTSxJQUFJLEdBQStCO0lBQ3ZDLEtBQUssRUFBRSxFQUFFO0lBQ1QsSUFBSSxFQUFFLEVBQUU7SUFDUixNQUFNLEVBQUUsS0FBSztJQUNiLGNBQWMsRUFBRSxDQUFDO0NBQ2xCLENBQUM7QUFFRixJQUFNLElBQUksR0FBRyxJQUFJLENBQUM7QUFDbEIsSUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDO0FBRXBCLElBQUksQ0FBQztJQUtILElBQUksRUFBRTtRQUNKLE1BQU0sRUFBRSxFQUFFO1FBQ1YsSUFBSSxFQUFFLE1BQU07UUFDWixLQUFLLEVBQUUsS0FBSztRQUNaLElBQUksRUFBRSxJQUFJO1FBQ1YsUUFBUSxFQUFFLEVBQUU7UUFDWixLQUFLLEVBQUU7WUFDTCxJQUFJO1lBQ0osTUFBTTtTQUNQO1FBQ0QsRUFBRSxFQUFFO1lBQ0YsSUFBSSxFQUFFLElBQUk7WUFDVixPQUFPLEVBQUUsRUFBRTtZQUNYLElBQUksRUFBRSxFQUFFO1lBQ1IsT0FBTyxFQUFFLEVBQUU7U0FDWjtRQUNELEdBQUcsRUFBRTtZQUNILElBQUksRUFBRSxJQUFJO1lBQ1YsTUFBTSxFQUFFLEVBQUU7U0FDWDtLQUNGO0lBS0QsTUFBTTtRQUFOLGlCQUtDO1FBSkMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxVQUFBLEdBQUcsSUFBSSxPQUFBLEtBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLEVBQXZCLENBQXVCLENBQUMsQ0FBQztRQUdqRCxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDbkIsQ0FBQztJQUtELE9BQU87SUFFUCxDQUFDO0lBS0QsTUFBTTtJQUVOLENBQUM7SUFLRCxNQUFNO0lBRU4sQ0FBQztJQUtELFFBQVE7UUFFTixJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7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QUFNLEdBQXNDO1lBQ2hELEtBQUssRUFBRSxvQkFBb0I7WUFDM0IsT0FBTyxFQUFFO2dCQUNQLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBRXRCLEtBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUNyQixDQUFDO1lBQ0QsSUFBSSxFQUFFLFVBQUEsR0FBRyxJQUFJLE9BQUEsT0FBTyxDQUFDLEdBQUcsQ0FBQywrQ0FBVSxHQUFHLENBQUMsTUFBUSxDQUFDLEVBQW5DLENBQW1DO1NBQ2pELENBQUM7UUFDRixFQUFFLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3ZCLENBQUM7Q0FDRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB3aWZpczogV2VjaGF0TWluaXByb2dyYW0uV2lmaUluZm9bXSA9IFtdO1xyXG5jb25zdCB3aWZpOiBXZWNoYXRNaW5pcHJvZ3JhbS5XaWZpSW5mbyA9IHtcclxuICBCU1NJRDogXCJcIixcclxuICBTU0lEOiBcIlwiLFxyXG4gIHNlY3VyZTogZmFsc2UsXHJcbiAgc2lnbmFsU3RyZW5ndGg6IDBcclxufTtcclxuXHJcbmNvbnN0IGF1dG8gPSBcIuiHquWKqFwiO1xyXG5jb25zdCBtYW51YWwgPSBcIuaJi+WKqFwiO1xyXG5cclxuUGFnZSh7XHJcblxyXG4gIC8qKlxyXG4gICAqIOmhtemdoueahOWIneWni+aVsOaNrlxyXG4gICAqL1xyXG4gIGRhdGE6IHtcclxuICAgIGRldmljZToge30sXHJcbiAgICB0eXBlOiBcIndpZmlcIixcclxuICAgIHdpZmlzOiB3aWZpcyxcclxuICAgIHdpZmk6IHdpZmksXHJcbiAgICBwYXNzd29yZDogXCJcIixcclxuICAgIG1vZGVzOiBbXHJcbiAgICAgIGF1dG8sXHJcbiAgICAgIG1hbnVhbFxyXG4gICAgXSxcclxuICAgIGlwOiB7XHJcbiAgICAgIG1vZGU6IGF1dG8sXHJcbiAgICAgIGFkZHJlc3M6IFwiXCIsXHJcbiAgICAgIG1hc2s6IFwiXCIsXHJcbiAgICAgIGdhdGV3YXk6IFwiXCIsXHJcbiAgICB9LFxyXG4gICAgZG5zOiB7XHJcbiAgICAgIG1vZGU6IGF1dG8sXHJcbiAgICAgIHZhbHVlczogW11cclxuICAgIH1cclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWKoOi9vVxyXG4gICAqL1xyXG4gIG9uTG9hZCgpIHtcclxuICAgIHd4Lm9uR2V0V2lmaUxpc3QocmVzID0+IHRoaXMub25HZXRXaUZpTGlzdChyZXMpKTtcclxuXHJcbiAgICAvLyDmiZPlvIAgV2lGaSDmqKHlnZdcclxuICAgIHRoaXMuc3RhcnRXaUZpKCk7XHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLliJ3mrKHmuLLmn5PlrozmiJBcclxuICAgKi9cclxuICBvblJlYWR5KCkge1xyXG5cclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouaYvuekulxyXG4gICAqL1xyXG4gIG9uU2hvdygpIHtcclxuXHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLpmpDol49cclxuICAgKi9cclxuICBvbkhpZGUoKSB7XHJcblxyXG4gIH0sXHJcblxyXG4gIC8qKlxyXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i5Y246L29XHJcbiAgICovXHJcbiAgb25VbmxvYWQoKSB7XHJcbiAgICAvLyDlhbPpl60gV2lGaSDmqKHlnZdcclxuICAgIHRoaXMuc3RvcFdpRmkoKTtcclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiDpobXpnaLnm7jlhbPkuovku7blpITnkIblh73mlbAtLeebkeWQrOeUqOaIt+S4i+aLieWKqOS9nFxyXG4gICAqL1xyXG4gIG9uUHVsbERvd25SZWZyZXNoKCkge1xyXG5cclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiDpobXpnaLkuIrmi4nop6blupXkuovku7bnmoTlpITnkIblh73mlbBcclxuICAgKi9cclxuICBvblJlYWNoQm90dG9tKCkge1xyXG5cclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiDnlKjmiLfngrnlh7vlj7PkuIrop5LliIbkuqtcclxuICAgKi9cclxuICBvblNoYXJlQXBwTWVzc2FnZShvcHRzKTogV2VjaGF0TWluaXByb2dyYW0uUGFnZS5JQ3VzdG9tU2hhcmVDb250ZW50IHtcclxuICAgIGNvbnNvbGUubG9nKG9wdHMudGFyZ2V0KVxyXG4gICAgcmV0dXJuIHt9XHJcbiAgfSxcclxuXHJcbiAgb25HZXRXaUZpTGlzdChyZXM6IFdlY2hhdE1pbmlwcm9ncmFtLk9uR2V0V2lmaUxpc3RDYWxsYmFja1Jlc3VsdCkge1xyXG4gICAgbGV0IHdpZmlzID0gcmVzLndpZmlMaXN0O1xyXG4gICAgY29uc3Qgd2lmaSA9IHRoaXMuZGF0YS53aWZpO1xyXG4gICAgaWYgKHdpZmkuU1NJRCAhPT0gXCJcIikge1xyXG4gICAgICB3aWZpcy51bnNoaWZ0KHdpZmkpO1xyXG4gICAgfVxyXG4gICAgd2lmaXMgPSB0aGlzLmRpc3RpbmN0KHJlcy53aWZpTGlzdCkuc29ydCgodzEsIHcyKSA9PiB3MS5TU0lELmxvY2FsZUNvbXBhcmUodzIuU1NJRCkpO1xyXG4gICAgY29uc29sZS5sb2cod2lmaXMpO1xyXG5cclxuICAgIGNvbnN0IGRhdGEgPSB7IHdpZmlzOiB3aWZpcyB9O1xyXG4gICAgdGhpcy5zZXREYXRhKGRhdGEpO1xyXG4gIH0sXHJcblxyXG4gIG9uVGFwU1NJRCgpIHtcclxuICAgIGNvbnN0IG9wdGlvbjE6IFdlY2hhdE1pbmlwcm9ncmFtLkdldFN5c3RlbUluZm9PcHRpb24gPSB7XHJcbiAgICAgIHN1Y2Nlc3M6IHJlcyA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coYOiOt+WPluezu+e7n+S/oeaBr+aIkOWKn++8miR7cmVzfWApO1xyXG5cclxuICAgICAgICAvLyBpT1Mg6ZyA6KaB5o+Q56S655So5oi36Lez6L2s57O757uf6K6+572u55WM6Z2iXHJcbiAgICAgICAgaWYgKHJlcy5wbGF0Zm9ybSA9PT0gXCJpb3NcIikge1xyXG4gICAgICAgICAgY29uc3Qgb3B0aW9uMjogV2VjaGF0TWluaXByb2dyYW0uU2hvd01vZGFsT3B0aW9uID0ge1xyXG4gICAgICAgICAgICB0aXRsZTogXCLmj5DnpLpcIixcclxuICAgICAgICAgICAgY29udGVudDogXCLnlLHkuo7ns7vnu5/pmZDliLbvvIxpT1Mg55So5oi36K+35omL5Yqo6L+b5YWl57O757ufIFdpRmkg6aG16Z2i77yM5b2T5YiX6KGo5Lit5Ye6546w55uu5qCHIFdpRmkg5pe25YaN6L+U5Zue5bCP56iL5bqP44CCXCIsXHJcbiAgICAgICAgICAgIHNob3dDYW5jZWw6IGZhbHNlLFxyXG4gICAgICAgICAgICBzdWNjZXNzOiByZXMgPT4ge1xyXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwi5o+Q56S65qGG5by55Ye65oiQ5YqfXCIpO1xyXG5cclxuICAgICAgICAgICAgICBpZiAocmVzLmNvbmZpcm0pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubmF2aWdhdGVUb1dpRmkoKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGZhaWw6IHJlcyA9PiBjb25zb2xlLmxvZyhg5o+Q56S656qX5by55Ye65aSx6LSl77yaJHtyZXMuZXJyTXNnfWApXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgd3guc2hvd01vZGFsKG9wdGlvbjIpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLm5hdmlnYXRlVG9XaUZpKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICBmYWlsOiByZXMgPT4gY29uc29sZS5sb2coYOiOt+WPluezu+e7n+S/oeaBr+Wksei0pe+8miR7cmVzLmVyck1zZ31gKVxyXG4gICAgfTtcclxuICAgIHd4LmdldFN5c3RlbUluZm8ob3B0aW9uMSk7XHJcbiAgICAvL3RoaXMuZ2V0V2lGaUxpc3QoKTtcclxuICB9LFxyXG5cclxuICBvbklQTW9kZUNoYW5nZShlOiBSZWNvcmQ8c3RyaW5nLCBhbnk+KSB7XHJcbiAgICBjb25zdCBudW1iZXIgPSBlLmRldGFpbC52YWx1ZTtcclxuICAgIGNvbnN0IG1vZGUgPSB0aGlzLmRhdGEubW9kZXNbbnVtYmVyXTtcclxuICAgIGNvbnN0IGRhdGE6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fTtcclxuICAgIGRhdGFbXCJpcC5tb2RlXCJdID0gbW9kZTtcclxuICAgIHRoaXMuc2V0RGF0YShkYXRhKTtcclxuICB9LFxyXG5cclxuICBvbkROU01vZGVDaGFuZ2UoKSB7XHJcblxyXG4gIH0sXHJcblxyXG4gIG5hdmlnYXRlVG9XaUZpKCkge1xyXG4gICAgY29uc3Qgd2lmaSA9IHRoaXMuZGF0YS53aWZpO1xyXG4gICAgY29uc3Qgb3B0aW9uOiBXZWNoYXRNaW5pcHJvZ3JhbS5OYXZpZ2F0ZVRvT3B0aW9uID0ge1xyXG4gICAgICB1cmw6IFwiLi4vd2lmaS93aWZpXCIsXHJcbiAgICAgIHN1Y2Nlc3M6IHJlcyA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCLot7PovawgV2lGaSDpobXpnaLmiJDlip9cIik7XHJcblxyXG4gICAgICAgIHJlcy5ldmVudENoYW5uZWwuZW1pdChcIndpZmlcIiwgd2lmaSk7XHJcbiAgICAgIH0sXHJcbiAgICAgIGZhaWw6IHJlcyA9PiBjb25zb2xlLmxvZyhg6Lez6L2sIFdpRmkg6aG16Z2i5aSx6LSl77yaJHtyZXMuZXJyTXNnfWApXHJcbiAgICB9O1xyXG4gICAgd3gubmF2aWdhdGVUbyhvcHRpb24pO1xyXG4gIH0sXHJcblxyXG4gIG9uV2lGaUNoYW5nZShlOiBhbnkpIHtcclxuICAgIGNvbnN0IG51bWJlciA9IGUuZGV0YWlsLnZhbHVlO1xyXG4gICAgY29uc3Qgc3NpZCA9IHRoaXMuZGF0YS53aWZpc1tudW1iZXJdLlNTSUQ7XHJcbiAgICBjb25zdCBkYXRhID0geyBcInNzaWRcIjogc3NpZCB9O1xyXG4gICAgdGhpcy5zZXREYXRhKGRhdGEpO1xyXG4gIH0sXHJcblxyXG4gIGRpc3RpbmN0KGFycjogV2VjaGF0TWluaXByb2dyYW0uV2lmaUluZm9bXSk6IFdlY2hhdE1pbmlwcm9ncmFtLldpZmlJbmZvW10ge1xyXG4gICAgY29uc3QgcmVzOiBXZWNoYXRNaW5pcHJvZ3JhbS5XaWZpSW5mb1tdID0gW107XHJcbiAgICBhcnIuZm9yRWFjaCh3MSA9PiB7XHJcbiAgICAgIGNvbnN0IHNvbWUgPSByZXMuc29tZSh3MiA9PiB3MS5TU0lEID09PSB3Mi5TU0lEKTtcclxuICAgICAgaWYgKHNvbWUpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgcmVzLnB1c2godzEpO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gcmVzO1xyXG4gIH0sXHJcblxyXG4gIG9uU3VibWl0KCkge1xyXG4gICAgLy8gY29uc3QgbW9kZSA9IFwiXCI7XHJcbiAgICAvLyBjb25zdCBhZGRyZXNzID0gdGhpcy5kYXRhLmFkZHJlc3M7XHJcbiAgICAvLyBjb25zdCBtYXNrID0gdGhpcy5kYXRhLm1hc2s7XHJcbiAgICAvLyBjb25zdCBnYXRld2F5ID0gdGhpcy5kYXRhLmlwLmdhdGV3YXk7XHJcbiAgICAvLyBjb25zdCBkbnMgPSB0aGlzLmRhdGEuZG5zLnZhbHVlcztcclxuICAgIC8vIHN3aXRjaCAobW9kZSkge1xyXG4gICAgLy8gICBjYXNlIGV0aGVybmV0OiB7XHJcbiAgICAvLyAgICAgdGhpcy5tb2RpZnkoXCJldGhlcm5ldFwiLCBhZGRyZXNzLCBtYXNrLCBnYXRld2F5LCBkbnMpO1xyXG4gICAgLy8gICAgIGJyZWFrO1xyXG4gICAgLy8gICB9XHJcbiAgICAvLyAgIGNhc2Ugd2lmaToge1xyXG4gICAgLy8gICAgIGNvbnN0IHNzaWQgPSB0aGlzLmRhdGEuc3NpZDtcclxuICAgIC8vICAgICBjb25zdCBwYXNzd29yZCA9IHRoaXMuZGF0YS5wYXNzd29yZDtcclxuICAgIC8vICAgICB0aGlzLm1vZGlmeShcIndpZmlcIiwgYWRkcmVzcywgbWFzaywgZ2F0ZXdheSwgZG5zLCBzc2lkLCBwYXNzd29yZCk7XHJcbiAgICAvLyAgICAgYnJlYWs7XHJcbiAgICAvLyAgIH1cclxuICAgIC8vICAgZGVmYXVsdDoge1xyXG4gICAgLy8gICAgIGNvbnNvbGUubG9nKGDov57mjqXmqKHlvI/plJnor6/vvJoke21vZGV9YCk7XHJcbiAgICAvLyAgICAgYnJlYWs7XHJcbiAgICAvLyAgIH1cclxuICAgIC8vIH1cclxuICB9LFxyXG5cclxuICBzdGFydFdpRmkoKSB7XHJcbiAgICBjb25zdCBvcHRpb246IFdlY2hhdE1pbmlwcm9ncmFtLlN0YXJ0V2lmaU9wdGlvbiA9IHtcclxuICAgICAgc3VjY2VzczogKCkgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwi5omT5byAIFdpRmkg5qih5Z2X5oiQ5YqfXCIpO1xyXG5cclxuICAgICAgICB0aGlzLmdldENvbm5lY3RlZFdpRmkoKTtcclxuICAgICAgfSxcclxuICAgICAgZmFpbDogcmVzID0+IGNvbnNvbGUubG9nKGDmiZPlvIAgV2lGaSDmqKHlnZflpLHotKXvvJoke3Jlcy5lcnJDb2RlfSAtICR7cmVzLmVyck1zZ31gKVxyXG4gICAgfTtcclxuICAgIHd4LnN0YXJ0V2lmaShvcHRpb24pO1xyXG4gIH0sXHJcblxyXG4gIHN0b3BXaUZpKCkge1xyXG4gICAgY29uc3Qgb3B0aW9uOiBXZWNoYXRNaW5pcHJvZ3JhbS5TdG9wV2lmaU9wdGlvbiA9IHtcclxuICAgICAgc3VjY2VzczogKCkgPT4gY29uc29sZS5sb2coXCLlhbPpl60gV2lGaSDmqKHlnZfmiJDlip9cIiksXHJcbiAgICAgIGZhaWw6IHJlcyA9PiBjb25zb2xlLmxvZyhg5YWz6ZetIFdpRmkg5qih5Z2X5aSx6LSl77yaJHtyZXMuZXJyQ29kZX0gLSAke3Jlcy5lcnJNc2d9YClcclxuICAgIH07XHJcbiAgICB3eC5zdG9wV2lmaShvcHRpb24pO1xyXG4gIH0sXHJcblxyXG4gIGdldENvbm5lY3RlZFdpRmkoKSB7XHJcbiAgICBjb25zdCBvcHRpb246IFdlY2hhdE1pbmlwcm9ncmFtLkdldENvbm5lY3RlZFdpZmlPcHRpb24gPSB7XHJcbiAgICAgIHN1Y2Nlc3M6IHJlcyA9PiB7XHJcbiAgICAgICAgY29uc3Qgd2lmaSA9IHJlcy53aWZpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGDojrflj5blt7Lov57mjqUgV2lGaSDmiJDlip86ICR7d2lmaX1gKTtcclxuXHJcbiAgICAgICAgY29uc3QgZGF0YSA9IHsgXCJ3aWZpc1wiOiBbd2lmaV0sIFwic3NpZFwiOiB3aWZpLlNTSUQgfTtcclxuICAgICAgICB0aGlzLnNldERhdGEoZGF0YSk7XHJcbiAgICAgIH0sXHJcbiAgICAgIGZhaWw6IHJlcyA9PiBjb25zb2xlLmxvZyhg6I635Y+W5bey6L+e5o6lIFdpRmkg5aSx6LSlOiAke3Jlcy5lcnJDb2RlfSAtICR7cmVzLmVyck1zZ31gKVxyXG4gICAgfTtcclxuICAgIHd4LmdldENvbm5lY3RlZFdpZmkob3B0aW9uKTtcclxuICB9LFxyXG5cclxuICBnZXRXaUZpTGlzdCgpIHtcclxuICAgIGNvbnN0IG9wdGlvbjE6IFdlY2hhdE1pbmlwcm9ncmFtLkdldFNldHRpbmdPcHRpb24gPSB7XHJcbiAgICAgIHN1Y2Nlc3M6IHJlcyA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coYOiOt+WPluiuvue9ruaIkOWKn++8miR7cmVzLmF1dGhTZXR0aW5nfWApO1xyXG5cclxuICAgICAgICBpZiAocmVzLmF1dGhTZXR0aW5nW1wic2NvcGUudXNlckxvY2F0aW9uXCJdKSB7XHJcbiAgICAgICAgICBjb25zdCBvcHRpb24yOiBXZWNoYXRNaW5pcHJvZ3JhbS5HZXRXaWZpTGlzdE9wdGlvbiA9IHtcclxuICAgICAgICAgICAgc3VjY2VzczogKCkgPT4gY29uc29sZS5sb2coYOiOt+WPliBXaUZpIOWIl+ihqOaIkOWKn2ApLFxyXG4gICAgICAgICAgICBmYWlsOiByZXMgPT4gY29uc29sZS5sb2coYOiOt+WPliBXaUZpIOWIl+ihqOWksei0pe+8miR7cmVzLmVyckNvZGV9IC0gJHtyZXMuZXJyTXNnfWApXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgd3guZ2V0V2lmaUxpc3Qob3B0aW9uMik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMuYXV0aG9yaXplKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICBmYWlsOiByZXMgPT4gY29uc29sZS5sb2coYOiOt+WPluiuvue9ruWksei0pe+8miR7cmVzLmVyck1zZ31gKVxyXG4gICAgfTtcclxuICAgIHd4LmdldFNldHRpbmcob3B0aW9uMSk7XHJcbiAgfSxcclxuXHJcbiAgYXV0aG9yaXplKCkge1xyXG4gICAgY29uc3Qgb3B0aW9uOiBXZWNoYXRNaW5pcHJvZ3JhbS5BdXRob3JpemVPcHRpb24gPSB7XHJcbiAgICAgIHNjb3BlOiBcInNjb3BlLnVzZXJMb2NhdGlvblwiLFxyXG4gICAgICBzdWNjZXNzOiAoKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCLnlLPor7fmnYPpmZDmiJDlip9cIik7XHJcblxyXG4gICAgICAgIHRoaXMuZ2V0V2lGaUxpc3QoKTtcclxuICAgICAgfSxcclxuICAgICAgZmFpbDogcmVzID0+IGNvbnNvbGUubG9nKGDnlLPor7fmnYPpmZDlpLHotKXvvJoke3Jlcy5lcnJNc2d9YClcclxuICAgIH07XHJcbiAgICB3eC5hdXRob3JpemUob3B0aW9uKTtcclxuICB9LFxyXG59KSJdfQ==