"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var encodeUtf8 = require("encode-utf8");
var decodeUtf8 = require("decode-utf8");
var serviceId = "6E400001-B5A3-F393-E0A9-E50E24DCCA9E";
var notifyCharacteristicId = "6E400003-B5A3-F393-E0A9-E50E24DCCA9E";
var writeCharacteristicId = "6E400002-B5A3-F393-E0A9-E50E24DCCA9E";
var getAdaptersCmd = "GET ADAPTERS";
var getStatusCmd = "GET STATUS";
var modifyCmd = "MODIFY";
var keepAliveCmd = "KEEP ALIVE";
var endSymbol = "\r\n";
var obj1 = {
    advertisData: new ArrayBuffer(0),
    advertisServiceUUIDs: [],
    serviceData: [],
    deviceId: "",
    RSSI: 0,
    name: "",
    localName: ""
};
var obj2 = [];
var intervalID = -1;
var hide = false;
var unload = false;
Page({
    data: {
        device: obj1,
        connected: false,
        adapters: obj2
    },
    onLoad: function () {
        var _this = this;
        console.log("device: onLoad");
        wx.onBLEConnectionStateChange(function (res) { return _this.onConnectionStateChange(res); });
        wx.onBLECharacteristicValueChange(function (res) { return _this.onCharacteristicValueChange(res); });
        var channel = this.getOpenerEventChannel();
        channel.on("device", function (device) { return _this.onLoadDevice(device); });
    },
    onReady: function () {
        console.log("device: onReady");
    },
    onShow: function () {
        console.log("device: onShow");
        hide = false;
        if (!this.data.connected) {
            this.connect();
        }
    },
    onHide: function () {
        console.log("device: onHide");
        hide = true;
    },
    onUnload: function () {
        console.log("device: onUnload");
        unload = true;
        this.disconnect();
    },
    onPullDownRefresh: function () {
    },
    onReachBottom: function () {
    },
    onShareAppMessage: function (opts) {
        console.log(opts.target);
        return {};
    },
    onLoadDevice: function (device) {
        var data = { "device": device };
        this.setData(data);
        this.connect();
    },
    onTapAdapter: function (e) {
        var device = this.data.device;
        var i = e.currentTarget.id;
        var adapter = this.data.adapters[i];
        var option = {
            url: "../adapter/adapter",
            success: function (res) { return res.eventChannel.emit("adapter", device, adapter); }
        };
        wx.navigateTo(option);
    },
    onConnectionStateChange: function (res) {
        var _this = this;
        var device = this.data.device;
        if (res.deviceId !== device.deviceId) {
            return;
        }
        var connected = res.connected;
        var data = { "connected": connected };
        this.setData(data);
        console.log("\u8FDE\u63A5\u72B6\u6001\u6539\u53D8\uFF1A" + connected);
        if (connected) {
            var option1 = {
                deviceId: device.deviceId,
                success: function () {
                    var option2 = {
                        deviceId: device.deviceId,
                        serviceId: serviceId,
                        success: function () {
                            var option3 = {
                                deviceId: device.deviceId,
                                serviceId: serviceId,
                                characteristicId: notifyCharacteristicId,
                                state: true,
                                success: function () {
                                    _this.keepAlive();
                                    _this.getAdapters();
                                },
                                fail: function (res) { return console.log("\u6253\u5F00\u901A\u77E5\u5931\u8D25\uFF1A " + res.errCode + " - " + res.errMsg); }
                            };
                            wx.notifyBLECharacteristicValueChange(option3);
                        },
                        fail: function (res) { return console.log("\u83B7\u53D6\u7279\u5F81\u503C\u5931\u8D25\uFF1A " + res.errCode + " - " + res.errMsg); }
                    };
                    wx.getBLEDeviceCharacteristics(option2);
                },
                fail: function (res) { return console.log("\u83B7\u53D6\u670D\u52A1\u5931\u8D25\uFF1A " + res.errCode + " - " + res.errMsg); }
            };
            wx.getBLEDeviceServices(option1);
        }
        else {
            clearInterval(intervalID);
            if (!hide && !unload) {
                this.connect();
            }
        }
    },
    buffer: new ArrayBuffer(0),
    onCharacteristicValueChange: function (res) {
        console.log("特征值改变");
        var device = this.data.device;
        if (res.deviceId !== device.deviceId || res.serviceId !== serviceId || res.characteristicId !== notifyCharacteristicId) {
            return;
        }
        if (this.buffer.byteLength === 0) {
            this.buffer = res.value;
        }
        else {
            var olderArray = new Uint8Array(this.buffer);
            var resArray = new Uint8Array(res.value);
            var newerArray = new Uint8Array(olderArray.length + resArray.length);
            newerArray.set(olderArray);
            newerArray.set(resArray, olderArray.length);
            this.buffer = newerArray.buffer;
        }
        if (this.buffer.byteLength < 2) {
            return;
        }
        var array = new Uint8Array(this.buffer);
        var code1 = array[array.length - 2];
        var code2 = array[array.length - 1];
        ;
        if (code1 !== 13 || code2 !== 10) {
            return;
        }
        var str = decodeUtf8(this.buffer).trim();
        console.log(str);
        this.dealWithStr(str);
        this.buffer = new ArrayBuffer(0);
    },
    dealWithStr: function (str) {
        var value = JSON.parse(str);
        var cmd = value.cmd;
        switch (cmd) {
            case getAdaptersCmd: {
                var adapters = value.adapters;
                var data = { adapters: adapters };
                this.setData(data);
                var names = adapters.map(function (i) { return i.name; });
                this.getStatus(names);
                break;
            }
            case getStatusCmd: {
                var status = value.status;
                var adapters_1 = this.data.adapters;
                status.forEach(function (item) {
                    for (var i = 0; i < adapters_1.length; i++) {
                        var adapter = adapters_1[i];
                        if (adapter.name === item.name) {
                            console.log("\u627E\u5230 " + adapter.name);
                            adapter.state = item.state;
                            adapter.ssid = item.ssid;
                            adapter.ip = item.ip;
                            adapter.dns = item.dns;
                            break;
                        }
                    }
                });
                var data = { adapters: adapters_1 };
                this.setData(data);
                wx.hideLoading();
                break;
            }
            case modifyCmd: {
                break;
            }
            default: {
                break;
            }
        }
    },
    onValuesChange: function (e) {
        var key = e.currentTarget.dataset.key;
        var value = e.detail.value;
        var data = {};
        data[key] = value;
        this.setData(data);
    },
    onIPChange: function (e) {
        var key = e.currentTarget.dataset.key;
        var value = e.detail.value;
        var data = {};
        data["ip." + key] = value;
        this.setData(data);
    },
    onDNSChange: function (e) {
        var key = e.currentTarget.dataset.key;
        var value = e.detail.value;
        var data = {};
        data["dns." + key] = value;
        this.setData(data);
    },
    connect: function () {
        var connected = this.data.connected;
        if (connected) {
            return;
        }
        var device = this.data.device;
        var option = {
            deviceId: device.deviceId,
            success: function () { return console.log("\u8FDE\u63A5\u6210\u529F"); },
            fail: function (res) { return console.log("\u8FDE\u63A5\u5931\u8D25\uFF1A" + res.errCode + " - " + res.errMsg); }
        };
        wx.createBLEConnection(option);
        this.showLoading("正在连接");
    },
    disconnect: function () {
        var connected = this.data.connected;
        if (!connected) {
            return;
        }
        var device = this.data.device;
        var option = {
            deviceId: device.deviceId,
            success: function () { return console.log("\u65AD\u5F00\u6210\u529F"); },
            fail: function (res) { return console.log("\u65AD\u5F00\u5931\u8D25\uFF1A" + res.errCode + " - " + res.errMsg); }
        };
        wx.closeBLEConnection(option);
    },
    write: function (str) {
        str = "" + str + endSymbol;
        var device = this.data.device;
        var value = encodeUtf8(str);
        var option2 = {
            deviceId: device.deviceId,
            serviceId: serviceId,
            characteristicId: writeCharacteristicId,
            value: value,
            success: function () { return console.log("\u5199\u5165\u6210\u529F\uFF1A" + str); },
            fail: function (res) { return console.log("\u5199\u5165\u5931\u8D25\uFF1A " + res.errCode + " - " + res.errMsg); }
        };
        wx.writeBLECharacteristicValue(option2);
    },
    keepAlive: function () {
        var _this = this;
        var value = {
            cmd: keepAliveCmd
        };
        var str = JSON.stringify(value);
        intervalID = setInterval(function () { return _this.write(str); }, 20 * 1000);
    },
    getAdapters: function () {
        var value = {
            cmd: getAdaptersCmd
        };
        var str = JSON.stringify(value);
        this.write(str);
    },
    getStatus: function (names) {
        var value = {
            cmd: getStatusCmd,
            names: names
        };
        var str = JSON.stringify(value);
        this.write(str);
    },
    modify: function (mode, address, mask, gateway, dns, ssid, password) {
        var value = {
            cmd: modifyCmd,
            mode: mode,
            ssid: ssid,
            password: password,
            address: address,
            mask: mask,
            gateway: gateway,
            dns: dns
        };
        var str = JSON.stringify(value);
        this.write(str);
        this.showLoading("正在配置网络");
    },
    showLoading: function (title) {
        var option = {
            title: title,
            mask: true
        };
        wx.showLoading(option);
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGV2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZGV2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsd0NBQTJDO0FBQzNDLHdDQUEyQztBQUUzQyxJQUFNLFNBQVMsR0FBVyxzQ0FBc0MsQ0FBQztBQUNqRSxJQUFNLHNCQUFzQixHQUFXLHNDQUFzQyxDQUFDO0FBQzlFLElBQU0scUJBQXFCLEdBQVcsc0NBQXNDLENBQUM7QUFDN0UsSUFBTSxjQUFjLEdBQVcsY0FBYyxDQUFDO0FBQzlDLElBQU0sWUFBWSxHQUFXLFlBQVksQ0FBQztBQUMxQyxJQUFNLFNBQVMsR0FBVyxRQUFRLENBQUM7QUFDbkMsSUFBTSxZQUFZLEdBQVcsWUFBWSxDQUFDO0FBRTFDLElBQU0sU0FBUyxHQUFHLE1BQU0sQ0FBQztBQUV6QixJQUFNLElBQUksR0FBb0Q7SUFDNUQsWUFBWSxFQUFFLElBQUksV0FBVyxDQUFDLENBQUMsQ0FBQztJQUNoQyxvQkFBb0IsRUFBRSxFQUFFO0lBQ3hCLFdBQVcsRUFBRSxFQUFFO0lBQ2YsUUFBUSxFQUFFLEVBQUU7SUFDWixJQUFJLEVBQUUsQ0FBQztJQUNQLElBQUksRUFBRSxFQUFFO0lBQ1IsU0FBUyxFQUFFLEVBQUU7Q0FDZCxDQUFDO0FBQ0YsSUFBTSxJQUFJLEdBQXVNLEVBQUUsQ0FBQztBQUVwTixJQUFJLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQztBQUNwQixJQUFJLElBQUksR0FBRyxLQUFLLENBQUM7QUFDakIsSUFBSSxNQUFNLEdBQUcsS0FBSyxDQUFDO0FBRW5CLElBQUksQ0FBQztJQUlILElBQUksRUFBRTtRQUNKLE1BQU0sRUFBRSxJQUFJO1FBQ1osU0FBUyxFQUFFLEtBQUs7UUFDaEIsUUFBUSxFQUFFLElBQUk7S0FDZjtJQUtELE1BQU07UUFBTixpQkFRQztRQVBDLE9BQU8sQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUU5QixFQUFFLENBQUMsMEJBQTBCLENBQUMsVUFBQSxH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LEdBQUcsRUFBRSxZQUFZO1lBQ2pCLEtBQUssRUFBRSxLQUFLO1NBQ2IsQ0FBQztRQUNGLElBQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDbEMsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNsQixDQUFDO0lBRUQsTUFBTSxZQUFDLElBQXlCLEVBQUUsT0FBZSxFQUFFLElBQVksRUFBRSxPQUFlLEVBQUUsR0FBYSxFQUFFLElBQWEsRUFBRSxRQUFpQjtRQUMvSCxJQUFNLEtBQUssR0FBRztZQUNaLEdBQUcsRUFBRSxTQUFTO1lBQ2QsSUFBSSxFQUFFLElBQUk7WUFDVixJQUFJLEVBQUUsSUFBSTtZQUNWLFFBQVEsRUFBRSxRQUFRO1lBQ2xCLE9BQU8sRUFBRSxPQUFPO1lBQ2hCLElBQUksRUFBRSxJQUFJO1lBQ1YsT0FBTyxFQUFFLE9BQU87WUFDaEIsR0FBRyxFQUFFLEdBQUc7U0FDVCxDQUFDO1FBQ0YsSUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNsQyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2hCLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUVELFdBQVcsWUFBQyxLQUFhO1FBQ3ZCLElBQU0sTUFBTSxHQUF3QztZQUNsRCxLQUFLLEVBQUUsS0FBSztZQUNaLElBQUksRUFBRSxJQUFJO1NBQ1gsQ0FBQztRQUNGLEVBQUUsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDekIsQ0FBQztDQUNGLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBlbmNvZGVVdGY4ID0gcmVxdWlyZShcImVuY29kZS11dGY4XCIpO1xyXG5pbXBvcnQgZGVjb2RlVXRmOCA9IHJlcXVpcmUoXCJkZWNvZGUtdXRmOFwiKTtcclxuXHJcbmNvbnN0IHNlcnZpY2VJZDogc3RyaW5nID0gXCI2RTQwMDAwMS1CNUEzLUYzOTMtRTBBOS1FNTBFMjREQ0NBOUVcIjtcclxuY29uc3Qgbm90aWZ5Q2hhcmFjdGVyaXN0aWNJZDogc3RyaW5nID0gXCI2RTQwMDAwMy1CNUEzLUYzOTMtRTBBOS1FNTBFMjREQ0NBOUVcIjtcclxuY29uc3Qgd3JpdGVDaGFyYWN0ZXJpc3RpY0lkOiBzdHJpbmcgPSBcIjZFNDAwMDAyLUI1QTMtRjM5My1FMEE5LUU1MEUyNERDQ0E5RVwiO1xyXG5jb25zdCBnZXRBZGFwdGVyc0NtZDogc3RyaW5nID0gXCJHRVQgQURBUFRFUlNcIjtcclxuY29uc3QgZ2V0U3RhdHVzQ21kOiBzdHJpbmcgPSBcIkdFVCBTVEFUVVNcIjtcclxuY29uc3QgbW9kaWZ5Q21kOiBzdHJpbmcgPSBcIk1PRElGWVwiO1xyXG5jb25zdCBrZWVwQWxpdmVDbWQ6IHN0cmluZyA9IFwiS0VFUCBBTElWRVwiO1xyXG5cclxuY29uc3QgZW5kU3ltYm9sID0gXCJcXHJcXG5cIjtcclxuXHJcbmNvbnN0IG9iajE6IFdlY2hhdE1pbmlwcm9ncmFtLkNhbGxiYWNrUmVzdWx0Qmx1ZVRvb3RoRGV2aWNlID0ge1xyXG4gIGFkdmVydGlzRGF0YTogbmV3IEFycmF5QnVmZmVyKDApLFxyXG4gIGFkdmVydGlzU2VydmljZVVVSURzOiBbXSxcclxuICBzZXJ2aWNlRGF0YTogW10sXHJcbiAgZGV2aWNlSWQ6IFwiXCIsXHJcbiAgUlNTSTogMCxcclxuICBuYW1lOiBcIlwiLFxyXG4gIGxvY2FsTmFtZTogXCJcIlxyXG59O1xyXG5jb25zdCBvYmoyOiB7IHR5cGU6IHN0cmluZywgbmFtZTogc3RyaW5nLCBzdGF0ZTogbnVtYmVyLCBzc2lkOiBzdHJpbmcsIGlwOiB7IG1vZGU6IFwiYXV0b1wiIHwgXCJtYW51YWxcIiwgYWRkcmVzczogc3RyaW5nLCBtYXNrOiBzdHJpbmcsIGdhdGV3YXk6IHN0cmluZyB9LCBkbnM6IHsgbW9kZTogXCJhdXRvXCIgfCBcIm1hbnVhbFwiLCB2YWx1ZXM6IHN0cmluZ1tdIH0gfVtdID0gW107XHJcblxyXG5sZXQgaW50ZXJ2YWxJRCA9IC0xO1xyXG5sZXQgaGlkZSA9IGZhbHNlO1xyXG5sZXQgdW5sb2FkID0gZmFsc2U7XHJcblxyXG5QYWdlKHtcclxuICAvKipcclxuICAgKiDpobXpnaLnmoTliJ3lp4vmlbDmja5cclxuICAgKi9cclxuICBkYXRhOiB7XHJcbiAgICBkZXZpY2U6IG9iajEsXHJcbiAgICBjb25uZWN0ZWQ6IGZhbHNlLFxyXG4gICAgYWRhcHRlcnM6IG9iajJcclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWKoOi9vVxyXG4gICAqL1xyXG4gIG9uTG9hZCgpIHtcclxuICAgIGNvbnNvbGUubG9nKFwiZGV2aWNlOiBvbkxvYWRcIik7XHJcblxyXG4gICAgd3gub25CTEVDb25uZWN0aW9uU3RhdGVDaGFuZ2UocmVzID0+IHRoaXMub25Db25uZWN0aW9uU3RhdGVDaGFuZ2UocmVzKSk7XHJcbiAgICB3eC5vbkJMRUNoYXJhY3RlcmlzdGljVmFsdWVDaGFuZ2UocmVzID0+IHRoaXMub25DaGFyYWN0ZXJpc3RpY1ZhbHVlQ2hhbmdlKHJlcykpO1xyXG5cclxuICAgIGNvbnN0IGNoYW5uZWwgPSB0aGlzLmdldE9wZW5lckV2ZW50Q2hhbm5lbCgpO1xyXG4gICAgY2hhbm5lbC5vbihcImRldmljZVwiLCBkZXZpY2UgPT4gdGhpcy5vbkxvYWREZXZpY2UoZGV2aWNlKSk7XHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLliJ3mrKHmuLLmn5PlrozmiJBcclxuICAgKi9cclxuICBvblJlYWR5KCkge1xyXG4gICAgY29uc29sZS5sb2coXCJkZXZpY2U6IG9uUmVhZHlcIik7XHJcblxyXG4gIH0sXHJcblxyXG4gIC8qKlxyXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i5pi+56S6XHJcbiAgICovXHJcbiAgb25TaG93KCkge1xyXG4gICAgY29uc29sZS5sb2coXCJkZXZpY2U6IG9uU2hvd1wiKTtcclxuXHJcbiAgICBoaWRlID0gZmFsc2U7XHJcbiAgICBpZiAoIXRoaXMuZGF0YS5jb25uZWN0ZWQpIHtcclxuICAgICAgdGhpcy5jb25uZWN0KCk7XHJcbiAgICB9XHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLpmpDol49cclxuICAgKi9cclxuICBvbkhpZGUoKSB7XHJcbiAgICBjb25zb2xlLmxvZyhcImRldmljZTogb25IaWRlXCIpO1xyXG5cclxuICAgIGhpZGUgPSB0cnVlO1xyXG4gIH0sXHJcblxyXG4gIC8qKlxyXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i5Y246L29XHJcbiAgICovXHJcbiAgb25VbmxvYWQoKSB7XHJcbiAgICBjb25zb2xlLmxvZyhcImRldmljZTogb25VbmxvYWRcIik7XHJcblxyXG4gICAgdW5sb2FkID0gdHJ1ZTtcclxuICAgIHRoaXMuZGlzY29ubmVjdCgpO1xyXG4gIH0sXHJcblxyXG4gIC8qKlxyXG4gICAqIOmhtemdouebuOWFs+S6i+S7tuWkhOeQhuWHveaVsC0t55uR5ZCs55So5oi35LiL5ouJ5Yqo5L2cXHJcbiAgICovXHJcbiAgb25QdWxsRG93blJlZnJlc2goKSB7XHJcblxyXG4gIH0sXHJcblxyXG4gIC8qKlxyXG4gICAqIOmhtemdouS4iuaLieinpuW6leS6i+S7tueahOWkhOeQhuWHveaVsFxyXG4gICAqL1xyXG4gIG9uUmVhY2hCb3R0b20oKSB7XHJcblxyXG4gIH0sXHJcblxyXG4gIC8qKlxyXG4gICAqIOeUqOaIt+eCueWHu+WPs+S4iuinkuWIhuS6q1xyXG4gICAqL1xyXG4gIG9uU2hhcmVBcHBNZXNzYWdlKG9wdHMpOiBXZWNoYXRNaW5pcHJvZ3JhbS5QYWdlLklDdXN0b21TaGFyZUNvbnRlbnQge1xyXG4gICAgY29uc29sZS5sb2cob3B0cy50YXJnZXQpXHJcbiAgICByZXR1cm4ge31cclxuICB9LFxyXG5cclxuICBvbkxvYWREZXZpY2UoZGV2aWNlOiBXZWNoYXRNaW5pcHJvZ3JhbS5DYWxsYmFja1Jlc3VsdEJsdWVUb290aERldmljZSkge1xyXG4gICAgY29uc3QgZGF0YTogUmVjb3JkPHN0cmluZywgYW55PiA9IHsgXCJkZXZpY2VcIjogZGV2aWNlIH07XHJcbiAgICB0aGlzLnNldERhdGEoZGF0YSk7XHJcbiAgICB0aGlzLmNvbm5lY3QoKTtcclxuICB9LFxyXG5cclxuICBvblRhcEFkYXB0ZXIoZTogYW55KSB7XHJcbiAgICBjb25zdCBkZXZpY2UgPSB0aGlzLmRhdGEuZGV2aWNlO1xyXG4gICAgY29uc3QgaSA9IGUuY3VycmVudFRhcmdldC5pZDtcclxuICAgIGNvbnN0IGFkYXB0ZXIgPSB0aGlzLmRhdGEuYWRhcHRlcnNbaV07XHJcbiAgICBjb25zdCBvcHRpb246IFdlY2hhdE1pbmlwcm9ncmFtLk5hdmlnYXRlVG9PcHRpb24gPSB7XHJcbiAgICAgIHVybDogXCIuLi9hZGFwdGVyL2FkYXB0ZXJcIixcclxuICAgICAgc3VjY2VzczogcmVzID0+IHJlcy5ldmVudENoYW5uZWwuZW1pdChcImFkYXB0ZXJcIiwgZGV2aWNlLCBhZGFwdGVyKVxyXG4gICAgfTtcclxuICAgIHd4Lm5hdmlnYXRlVG8ob3B0aW9uKTtcclxuICB9LFxyXG5cclxuICBvbkNvbm5lY3Rpb25TdGF0ZUNoYW5nZShyZXM6IFdlY2hhdE1pbmlwcm9ncmFtLk9uQkxFQ29ubmVjdGlvblN0YXRlQ2hhbmdlQ2FsbGJhY2tSZXN1bHQpIHtcclxuICAgIGNvbnN0IGRldmljZSA9IHRoaXMuZGF0YS5kZXZpY2U7XHJcbiAgICBpZiAocmVzLmRldmljZUlkICE9PSBkZXZpY2UuZGV2aWNlSWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgY29ubmVjdGVkOiBib29sZWFuID0gcmVzLmNvbm5lY3RlZDtcclxuICAgIGNvbnN0IGRhdGE6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7IFwiY29ubmVjdGVkXCI6IGNvbm5lY3RlZCB9O1xyXG4gICAgdGhpcy5zZXREYXRhKGRhdGEpO1xyXG4gICAgY29uc29sZS5sb2coYOi/nuaOpeeKtuaAgeaUueWPmO+8miR7Y29ubmVjdGVkfWApO1xyXG4gICAgaWYgKGNvbm5lY3RlZCkge1xyXG4gICAgICAvLyDojrflj5bpgJrnn6XnibnlvoHlgLzvvIzmiZPlvIDpgJrnn6VcclxuICAgICAgLy8g6I635Y+W5YaZ5YWl54m55b6B5YC877yM5Y+R6YCB5oyH5LukXHJcbiAgICAgIGNvbnN0IG9wdGlvbjE6IFdlY2hhdE1pbmlwcm9ncmFtLkdldEJMRURldmljZVNlcnZpY2VzT3B0aW9uID0ge1xyXG4gICAgICAgIGRldmljZUlkOiBkZXZpY2UuZGV2aWNlSWQsXHJcbiAgICAgICAgc3VjY2VzczogKCkgPT4ge1xyXG4gICAgICAgICAgY29uc3Qgb3B0aW9uMjogV2VjaGF0TWluaXByb2dyYW0uR2V0QkxFRGV2aWNlQ2hhcmFjdGVyaXN0aWNzT3B0aW9uID0ge1xyXG4gICAgICAgICAgICBkZXZpY2VJZDogZGV2aWNlLmRldmljZUlkLFxyXG4gICAgICAgICAgICBzZXJ2aWNlSWQ6IHNlcnZpY2VJZCxcclxuICAgICAgICAgICAgc3VjY2VzczogKCkgPT4ge1xyXG4gICAgICAgICAgICAgIGNvbnN0IG9wdGlvbjM6IFdlY2hhdE1pbmlwcm9ncmFtLk5vdGlmeUJMRUNoYXJhY3RlcmlzdGljVmFsdWVDaGFuZ2VPcHRpb24gPSB7XHJcbiAgICAgICAgICAgICAgICBkZXZpY2VJZDogZGV2aWNlLmRldmljZUlkLFxyXG4gICAgICAgICAgICAgICAgc2VydmljZUlkOiBzZXJ2aWNlSWQsXHJcbiAgICAgICAgICAgICAgICBjaGFyYWN0ZXJpc3RpY0lkOiBub3RpZnlDaGFyYWN0ZXJpc3RpY0lkLFxyXG4gICAgICAgICAgICAgICAgc3RhdGU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgIHRoaXMua2VlcEFsaXZlKCk7XHJcbiAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0QWRhcHRlcnMoKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBmYWlsOiByZXMgPT4gY29uc29sZS5sb2coYOaJk+W8gOmAmuefpeWksei0pe+8miAke3Jlcy5lcnJDb2RlfSAtICR7cmVzLmVyck1zZ31gKVxyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgd3gubm90aWZ5QkxFQ2hhcmFjdGVyaXN0aWNWYWx1ZUNoYW5nZShvcHRpb24zKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZmFpbDogcmVzID0+IGNvbnNvbGUubG9nKGDojrflj5bnibnlvoHlgLzlpLHotKXvvJogJHtyZXMuZXJyQ29kZX0gLSAke3Jlcy5lcnJNc2d9YClcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICB3eC5nZXRCTEVEZXZpY2VDaGFyYWN0ZXJpc3RpY3Mob3B0aW9uMik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBmYWlsOiByZXMgPT4gY29uc29sZS5sb2coYOiOt+WPluacjeWKoeWksei0pe+8miAke3Jlcy5lcnJDb2RlfSAtICR7cmVzLmVyck1zZ31gKVxyXG4gICAgICB9O1xyXG4gICAgICB3eC5nZXRCTEVEZXZpY2VTZXJ2aWNlcyhvcHRpb24xKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIOWBnOatouW/g+i3s1xyXG4gICAgICBjbGVhckludGVydmFsKGludGVydmFsSUQpO1xyXG4gICAgICAvLyDlvILluLjmlq3lvIDvvIzlsJ3or5Xph43mlrDov57mjqVcclxuICAgICAgaWYgKCFoaWRlICYmICF1bmxvYWQpIHtcclxuICAgICAgICB0aGlzLmNvbm5lY3QoKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIGJ1ZmZlcjogbmV3IEFycmF5QnVmZmVyKDApLFxyXG5cclxuICBvbkNoYXJhY3RlcmlzdGljVmFsdWVDaGFuZ2UocmVzOiBXZWNoYXRNaW5pcHJvZ3JhbS5PbkJMRUNoYXJhY3RlcmlzdGljVmFsdWVDaGFuZ2VDYWxsYmFja1Jlc3VsdCkge1xyXG4gICAgY29uc29sZS5sb2coXCLnibnlvoHlgLzmlLnlj5hcIik7XHJcblxyXG4gICAgY29uc3QgZGV2aWNlID0gdGhpcy5kYXRhLmRldmljZTtcclxuICAgIGlmIChyZXMuZGV2aWNlSWQgIT09IGRldmljZS5kZXZpY2VJZCB8fCByZXMuc2VydmljZUlkICE9PSBzZXJ2aWNlSWQgfHwgcmVzLmNoYXJhY3RlcmlzdGljSWQgIT09IG5vdGlmeUNoYXJhY3RlcmlzdGljSWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLmJ1ZmZlci5ieXRlTGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHRoaXMuYnVmZmVyID0gcmVzLnZhbHVlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8g5ZCI5bm2IEFycmF5QnVmZmVyXHJcbiAgICAgIGNvbnN0IG9sZGVyQXJyYXkgPSBuZXcgVWludDhBcnJheSh0aGlzLmJ1ZmZlcik7XHJcbiAgICAgIGNvbnN0IHJlc0FycmF5ID0gbmV3IFVpbnQ4QXJyYXkocmVzLnZhbHVlKTtcclxuICAgICAgY29uc3QgbmV3ZXJBcnJheSA9IG5ldyBVaW50OEFycmF5KG9sZGVyQXJyYXkubGVuZ3RoICsgcmVzQXJyYXkubGVuZ3RoKTtcclxuICAgICAgbmV3ZXJBcnJheS5zZXQob2xkZXJBcnJheSk7XHJcbiAgICAgIG5ld2VyQXJyYXkuc2V0KHJlc0FycmF5LCBvbGRlckFycmF5Lmxlbmd0aCk7XHJcbiAgICAgIHRoaXMuYnVmZmVyID0gbmV3ZXJBcnJheS5idWZmZXI7XHJcbiAgICAgIC8vIGNvbnN0IHJlc1ZpZXcgPSBuZXcgRGF0YVZpZXcocmVzLnZhbHVlKTtcclxuICAgICAgLy8gY29uc3Qgb2xkZXJWaWV3ID0gbmV3IERhdGFWaWV3KHRoaXMuYnVmZmVyKTtcclxuICAgICAgLy8gY29uc3QgYnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKHRoaXMuYnVmZmVyLmJ5dGVMZW5ndGggKyByZXMudmFsdWUuYnl0ZUxlbmd0aCk7XHJcbiAgICAgIC8vIGNvbnN0IG5ld2VyVmlldyA9IG5ldyBEYXRhVmlldyhidWZmZXIpO1xyXG4gICAgICAvLyBmb3IgKGxldCBpID0gMDsgaSA8IG9sZGVyVmlldy5ieXRlTGVuZ3RoOyBpKyspIHtcclxuICAgICAgLy8gICBjb25zdCBpdGVtID0gb2xkZXJWaWV3LmdldFVpbnQ4KGkpO1xyXG4gICAgICAvLyAgIG5ld2VyVmlldy5zZXRVaW50OChpLCBpdGVtKTtcclxuICAgICAgLy8gfVxyXG4gICAgICAvLyBmb3IgKGxldCBpID0gMDsgaSA8IHJlc1ZpZXcuYnl0ZUxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIC8vICAgY29uc3QgaXRlbSA9IHJlc1ZpZXcuZ2V0VWludDgoaSk7XHJcbiAgICAgIC8vICAgbmV3ZXJWaWV3LnNldFVpbnQ4KG9sZGVyVmlldy5ieXRlTGVuZ3RoICsgaSwgaXRlbSk7XHJcbiAgICAgIC8vIH1cclxuICAgICAgLy8gdGhpcy5idWZmZXIgPSBuZXdlclZpZXcuYnVmZmVyO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOaYr+WQpuS7pSBcXHJcXG4g57uT5bC+XHJcbiAgICBpZiAodGhpcy5idWZmZXIuYnl0ZUxlbmd0aCA8IDIpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgYXJyYXkgPSBuZXcgVWludDhBcnJheSh0aGlzLmJ1ZmZlcik7XHJcbiAgICBjb25zdCBjb2RlMSA9IGFycmF5W2FycmF5Lmxlbmd0aCAtIDJdO1xyXG4gICAgY29uc3QgY29kZTIgPSBhcnJheVthcnJheS5sZW5ndGggLSAxXTs7XHJcbiAgICBpZiAoY29kZTEgIT09IDEzIHx8IGNvZGUyICE9PSAxMCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBsZXQgc3RyOiBzdHJpbmcgPSBkZWNvZGVVdGY4KHRoaXMuYnVmZmVyKS50cmltKCk7XHJcbiAgICBjb25zb2xlLmxvZyhzdHIpO1xyXG5cclxuICAgIHRoaXMuZGVhbFdpdGhTdHIoc3RyKTtcclxuICAgIHRoaXMuYnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKDApO1xyXG4gIH0sXHJcblxyXG4gIGRlYWxXaXRoU3RyKHN0cjogc3RyaW5nKSB7XHJcbiAgICBjb25zdCB2YWx1ZTogeyBbc3RyOiBzdHJpbmddOiBhbnksIGNtZDogc3RyaW5nLCBlcnJDb2RlOiBudW1iZXIgfSA9IEpTT04ucGFyc2Uoc3RyKTtcclxuICAgIGNvbnN0IGNtZCA9IHZhbHVlLmNtZDtcclxuICAgIHN3aXRjaCAoY21kKSB7XHJcbiAgICAgIGNhc2UgZ2V0QWRhcHRlcnNDbWQ6IHtcclxuICAgICAgICBjb25zdCBhZGFwdGVyczogW3sgdHlwZTogc3RyaW5nLCBuYW1lOiBzdHJpbmcgfV0gPSB2YWx1ZS5hZGFwdGVycztcclxuICAgICAgICBjb25zdCBkYXRhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0geyBhZGFwdGVyczogYWRhcHRlcnMgfTtcclxuICAgICAgICB0aGlzLnNldERhdGEoZGF0YSk7XHJcbiAgICAgICAgY29uc3QgbmFtZXMgPSBhZGFwdGVycy5tYXAoaSA9PiBpLm5hbWUpO1xyXG4gICAgICAgIHRoaXMuZ2V0U3RhdHVzKG5hbWVzKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgICBjYXNlIGdldFN0YXR1c0NtZDoge1xyXG4gICAgICAgIGNvbnN0IHN0YXR1czogeyBuYW1lOiBzdHJpbmcsIHN0YXRlOiBudW1iZXIsIHNzaWQ6IHN0cmluZywgaXA6IHsgbW9kZTogXCJhdXRvXCIgfCBcIm1hbnVhbFwiLCBhZGRyZXNzOiBzdHJpbmcsIG1hc2s6IHN0cmluZywgZ2F0ZXdheTogc3RyaW5nIH0sIGRuczogeyBtb2RlOiBcImF1dG9cIiB8IFwibWFudWFsXCIsIHZhbHVlczogc3RyaW5nW10gfSB9W10gPSB2YWx1ZS5zdGF0dXM7XHJcbiAgICAgICAgY29uc3QgYWRhcHRlcnMgPSB0aGlzLmRhdGEuYWRhcHRlcnM7XHJcbiAgICAgICAgc3RhdHVzLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFkYXB0ZXJzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGFkYXB0ZXIgPSBhZGFwdGVyc1tpXTtcclxuICAgICAgICAgICAgaWYgKGFkYXB0ZXIubmFtZSA9PT0gaXRlbS5uYW1lKSB7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coYOaJvuWIsCAke2FkYXB0ZXIubmFtZX1gKTtcclxuXHJcbiAgICAgICAgICAgICAgYWRhcHRlci5zdGF0ZSA9IGl0ZW0uc3RhdGU7XHJcbiAgICAgICAgICAgICAgYWRhcHRlci5zc2lkID0gaXRlbS5zc2lkO1xyXG4gICAgICAgICAgICAgIGFkYXB0ZXIuaXAgPSBpdGVtLmlwO1xyXG4gICAgICAgICAgICAgIGFkYXB0ZXIuZG5zID0gaXRlbS5kbnM7XHJcbiAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zdCBkYXRhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0geyBhZGFwdGVyczogYWRhcHRlcnMgfTtcclxuICAgICAgICB0aGlzLnNldERhdGEoZGF0YSk7XHJcbiAgICAgICAgd3guaGlkZUxvYWRpbmcoKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgICBjYXNlIG1vZGlmeUNtZDoge1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICAgIGRlZmF1bHQ6IHtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIG9uVmFsdWVzQ2hhbmdlKGU6IGFueSkge1xyXG4gICAgY29uc3QgeyBrZXkgfSA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0O1xyXG4gICAgY29uc3QgdmFsdWUgPSBlLmRldGFpbC52YWx1ZTtcclxuICAgIGNvbnN0IGRhdGE6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fTtcclxuICAgIGRhdGFba2V5XSA9IHZhbHVlO1xyXG4gICAgdGhpcy5zZXREYXRhKGRhdGEpO1xyXG4gIH0sXHJcblxyXG4gIG9uSVBDaGFuZ2UoZTogYW55KSB7XHJcbiAgICBjb25zdCB7IGtleSB9ID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQ7XHJcbiAgICBjb25zdCB2YWx1ZSA9IGUuZGV0YWlsLnZhbHVlO1xyXG4gICAgY29uc3QgZGF0YTogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9O1xyXG4gICAgZGF0YVtgaXAuJHtrZXl9YF0gPSB2YWx1ZTtcclxuICAgIHRoaXMuc2V0RGF0YShkYXRhKTtcclxuICB9LFxyXG5cclxuICBvbkROU0NoYW5nZShlOiBhbnkpIHtcclxuICAgIGNvbnN0IHsga2V5IH0gPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldDtcclxuICAgIGNvbnN0IHZhbHVlID0gZS5kZXRhaWwudmFsdWU7XHJcbiAgICBjb25zdCBkYXRhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge307XHJcbiAgICBkYXRhW2BkbnMuJHtrZXl9YF0gPSB2YWx1ZTtcclxuICAgIHRoaXMuc2V0RGF0YShkYXRhKTtcclxuICB9LFxyXG5cclxuICBjb25uZWN0KCkge1xyXG4gICAgY29uc3QgY29ubmVjdGVkID0gdGhpcy5kYXRhLmNvbm5lY3RlZDtcclxuICAgIGlmIChjb25uZWN0ZWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZGV2aWNlID0gdGhpcy5kYXRhLmRldmljZTtcclxuICAgIGNvbnN0IG9wdGlvbjogV2VjaGF0TWluaXByb2dyYW0uQ3JlYXRlQkxFQ29ubmVjdGlvbk9wdGlvbiA9IHtcclxuICAgICAgZGV2aWNlSWQ6IGRldmljZS5kZXZpY2VJZCxcclxuICAgICAgc3VjY2VzczogKCkgPT4gY29uc29sZS5sb2coYOi/nuaOpeaIkOWKn2ApLFxyXG4gICAgICBmYWlsOiByZXMgPT4gY29uc29sZS5sb2coYOi/nuaOpeWksei0pe+8miR7cmVzLmVyckNvZGV9IC0gJHtyZXMuZXJyTXNnfWApXHJcbiAgICB9O1xyXG4gICAgd3guY3JlYXRlQkxFQ29ubmVjdGlvbihvcHRpb24pO1xyXG4gICAgdGhpcy5zaG93TG9hZGluZyhcIuato+WcqOi/nuaOpVwiKTtcclxuICB9LFxyXG5cclxuICBkaXNjb25uZWN0KCkge1xyXG4gICAgY29uc3QgY29ubmVjdGVkID0gdGhpcy5kYXRhLmNvbm5lY3RlZDtcclxuICAgIGlmICghY29ubmVjdGVkKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGRldmljZSA9IHRoaXMuZGF0YS5kZXZpY2U7XHJcbiAgICBjb25zdCBvcHRpb246IFdlY2hhdE1pbmlwcm9ncmFtLkNsb3NlQkxFQ29ubmVjdGlvbk9wdGlvbiA9IHtcclxuICAgICAgZGV2aWNlSWQ6IGRldmljZS5kZXZpY2VJZCxcclxuICAgICAgc3VjY2VzczogKCkgPT4gY29uc29sZS5sb2coYOaWreW8gOaIkOWKn2ApLFxyXG4gICAgICBmYWlsOiByZXMgPT4gY29uc29sZS5sb2coYOaWreW8gOWksei0pe+8miR7cmVzLmVyckNvZGV9IC0gJHtyZXMuZXJyTXNnfWApXHJcbiAgICB9O1xyXG4gICAgd3guY2xvc2VCTEVDb25uZWN0aW9uKG9wdGlvbik7XHJcbiAgfSxcclxuXHJcbiAgd3JpdGUoc3RyOiBzdHJpbmcpIHtcclxuICAgIHN0ciA9IGAke3N0cn0ke2VuZFN5bWJvbH1gO1xyXG4gICAgY29uc3QgZGV2aWNlID0gdGhpcy5kYXRhLmRldmljZTtcclxuICAgIGNvbnN0IHZhbHVlID0gZW5jb2RlVXRmOChzdHIpO1xyXG4gICAgY29uc3Qgb3B0aW9uMjogV2VjaGF0TWluaXByb2dyYW0uV3JpdGVCTEVDaGFyYWN0ZXJpc3RpY1ZhbHVlT3B0aW9uID0ge1xyXG4gICAgICBkZXZpY2VJZDogZGV2aWNlLmRldmljZUlkLFxyXG4gICAgICBzZXJ2aWNlSWQ6IHNlcnZpY2VJZCxcclxuICAgICAgY2hhcmFjdGVyaXN0aWNJZDogd3JpdGVDaGFyYWN0ZXJpc3RpY0lkLFxyXG4gICAgICB2YWx1ZTogdmFsdWUsXHJcbiAgICAgIHN1Y2Nlc3M6ICgpID0+IGNvbnNvbGUubG9nKGDlhpnlhaXmiJDlip/vvJoke3N0cn1gKSxcclxuICAgICAgZmFpbDogcmVzID0+IGNvbnNvbGUubG9nKGDlhpnlhaXlpLHotKXvvJogJHtyZXMuZXJyQ29kZX0gLSAke3Jlcy5lcnJNc2d9YClcclxuICAgIH07XHJcbiAgICB3eC53cml0ZUJMRUNoYXJhY3RlcmlzdGljVmFsdWUob3B0aW9uMik7XHJcbiAgfSxcclxuXHJcbiAga2VlcEFsaXZlKCkge1xyXG4gICAgY29uc3QgdmFsdWUgPSB7XHJcbiAgICAgIGNtZDoga2VlcEFsaXZlQ21kXHJcbiAgICB9O1xyXG4gICAgY29uc3Qgc3RyID0gSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xyXG4gICAgaW50ZXJ2YWxJRCA9IHNldEludGVydmFsKCgpID0+IHRoaXMud3JpdGUoc3RyKSwgMjAgKiAxMDAwKTtcclxuICB9LFxyXG5cclxuICBnZXRBZGFwdGVycygpIHtcclxuICAgIGNvbnN0IHZhbHVlID0ge1xyXG4gICAgICBjbWQ6IGdldEFkYXB0ZXJzQ21kXHJcbiAgICB9O1xyXG4gICAgY29uc3Qgc3RyID0gSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xyXG4gICAgdGhpcy53cml0ZShzdHIpO1xyXG4gIH0sXHJcblxyXG4gIGdldFN0YXR1cyhuYW1lczogc3RyaW5nW10pIHtcclxuICAgIGNvbnN0IHZhbHVlID0ge1xyXG4gICAgICBjbWQ6IGdldFN0YXR1c0NtZCxcclxuICAgICAgbmFtZXM6IG5hbWVzXHJcbiAgICB9O1xyXG4gICAgY29uc3Qgc3RyID0gSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xyXG4gICAgdGhpcy53cml0ZShzdHIpO1xyXG4gIH0sXHJcblxyXG4gIG1vZGlmeShtb2RlOiBcImV0aGVybmV0XCIgfCBcIndpZmlcIiwgYWRkcmVzczogc3RyaW5nLCBtYXNrOiBzdHJpbmcsIGdhdGV3YXk6IHN0cmluZywgZG5zOiBzdHJpbmdbXSwgc3NpZD86IHN0cmluZywgcGFzc3dvcmQ/OiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IHZhbHVlID0ge1xyXG4gICAgICBjbWQ6IG1vZGlmeUNtZCxcclxuICAgICAgbW9kZTogbW9kZSxcclxuICAgICAgc3NpZDogc3NpZCxcclxuICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkLFxyXG4gICAgICBhZGRyZXNzOiBhZGRyZXNzLFxyXG4gICAgICBtYXNrOiBtYXNrLFxyXG4gICAgICBnYXRld2F5OiBnYXRld2F5LFxyXG4gICAgICBkbnM6IGRuc1xyXG4gICAgfTtcclxuICAgIGNvbnN0IHN0ciA9IEpTT04uc3RyaW5naWZ5KHZhbHVlKTtcclxuICAgIHRoaXMud3JpdGUoc3RyKTtcclxuICAgIHRoaXMuc2hvd0xvYWRpbmcoXCLmraPlnKjphY3nva7nvZHnu5xcIik7XHJcbiAgfSxcclxuXHJcbiAgc2hvd0xvYWRpbmcodGl0bGU6IHN0cmluZykge1xyXG4gICAgY29uc3Qgb3B0aW9uOiBXZWNoYXRNaW5pcHJvZ3JhbS5TaG93TG9hZGluZ09wdGlvbiA9IHtcclxuICAgICAgdGl0bGU6IHRpdGxlLFxyXG4gICAgICBtYXNrOiB0cnVlXHJcbiAgICB9O1xyXG4gICAgd3guc2hvd0xvYWRpbmcob3B0aW9uKTtcclxuICB9XHJcbn0pOyJdfQ==